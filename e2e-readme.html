<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Care Commons: End-to-End Testing Guide - Care Commons Documentation</title>
  <meta name="description" content="Comprehensive documentation for Care Commons - Shared care software, community owned">
  <link rel="stylesheet" href="./styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      hljs.highlightAll();
      
      // Mobile menu toggle
      const menuToggle = document.querySelector('.menu-toggle');
      const sidebar = document.querySelector('.sidebar');
      if (menuToggle && sidebar) {
        menuToggle.addEventListener('click', () => {
          sidebar.classList.toggle('open');
        });
      }
      
      // Search functionality
      const searchInput = document.getElementById('search-input');
      const searchResults = document.getElementById('search-results');
      
      if (searchInput && searchResults) {
        searchInput.addEventListener('input', (e) => {
          const query = e.target.value.toLowerCase();
          if (query.length < 2) {
            searchResults.innerHTML = '';
            searchResults.style.display = 'none';
            return;
          }
          
          // Simple search through navigation items
          const navItems = document.querySelectorAll('.sidebar a');
          const matches = Array.from(navItems)
            .filter(item => item.textContent.toLowerCase().includes(query))
            .slice(0, 10);
          
          if (matches.length > 0) {
            searchResults.innerHTML = matches
              .map(item => `<a href="${item.href}" class="search-result">${item.textContent}</a>`)
              .join('');
            searchResults.style.display = 'block';
          } else {
            searchResults.innerHTML = '<div class="search-result no-results">No results found</div>';
            searchResults.style.display = 'block';
          }
        });
        
        // Hide results when clicking outside
        document.addEventListener('click', (e) => {
          if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
            searchResults.style.display = 'none';
          }
        });
      }
    });
  </script>
</head>
<body>
  <div class="container">
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1><a href="./index.html">Care Commons Docs</a></h1>
        <button class="menu-toggle" aria-label="Toggle menu">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
      <div class="search-container">
        <input type="text" id="search-input" placeholder="Search documentation..." />
        <div id="search-results"></div>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-category">
      <h3>üöÄ Getting Started</h3>
      <ul><li><a href="./api-readme.html">API Directory - Vercel Serverless Functions</a></li><li><a href="./claude-layer-2-input-readme.html">Layer 2 Implementation Tasks</a></li><li><a href="./claude-readme.html">Claude Autonomous Task Management System</a></li><li><a href="./database-quickstart.html">Database Quick Start</a></li><li><a href="./demo-quickstart.html">Rich Interactive Demo - Quick Start Guide</a></li><li><a href="./deployment-quick-start.html">Deployment Quick Start Guide</a></li><li><a href="./deployment-quickstart.html">Deployment Quick Start</a></li><li><a href="./docs-compliance-readme.html">State Compliance Documentation</a></li><li><a href="./e2e-readme.html">Care Commons: End-to-End Testing Guide</a></li><li><a href="./packages-mobile-quickstart-mobile.html">Mobile App Quick Start Guide</a></li><li><a href="./packages-mobile-quickstart.html">Mobile App Quickstart Guide</a></li><li><a href="./packages-web-quickstart.html">Quick Start Guide</a></li><li><a href="./readme.html">Care Commons</a></li><li><a href="./scripts-readme.html">Care Commons Deployment Scripts</a></li><li><a href="./showcase-quick-start.html">Showcase Quick Start Guide</a></li><li><a href="./showcase-readme.html">Care Commons Showcase</a></li><li><a href="./vercel-quickstart.html">Vercel Environment Setup - Quick Start</a></li><li><a href="./verticals-analytics-reporting-readme.html">Analytics & Reporting Vertical</a></li><li><a href="./verticals-billing-invoicing-readme.html">Billing & Invoicing</a></li><li><a href="./verticals-care-plans-tasks-quickstart.html">Care Plans & Tasks Library - Quickstart</a></li><li><a href="./verticals-care-plans-tasks-readme.html">Care Plans & Tasks Library</a></li><li><a href="./verticals-caregiver-staff-quickstart.html">Caregiver & Staff Management - Quick Start</a></li><li><a href="./verticals-caregiver-staff-readme.html">Caregiver & Staff Management</a></li><li><a href="./verticals-client-demographics-readme.html">Client & Demographics Management</a></li><li><a href="./verticals-family-engagement-readme.html">Family Engagement Platform (Consolidated)</a></li><li><a href="./verticals-payroll-processing-readme.html">Payroll Processing</a></li><li><a href="./verticals-quality-assurance-audits-readme.html">Quality Assurance & Audits Vertical</a></li><li><a href="./verticals-scheduling-visits-quickstart.html">Quickstart: Scheduling & Visit Management</a></li><li><a href="./verticals-scheduling-visits-readme.html">Scheduling & Visit Management</a></li><li><a href="./verticals-shift-matching-readme.html">Shift Matching & Assignment</a></li><li><a href="./verticals-time-tracking-evv-quickstart.html">Time Tracking & EVV - Quick Start Guide</a></li><li><a href="./verticals-time-tracking-evv-readme.html">Time Tracking & Electronic Visit Verification (EVV)</a></li></ul></div><div class="nav-category">
      <h3>üìñ User Guides</h3>
      <ul><li><a href="./claude-0002-fix-client-demographics-api-error.html">Task 0002: Fix Client Demographics API Type Error</a></li><li><a href="./docs-deployment-guide.html">Care Commons Deployment Guide</a></li><li><a href="./docs-performance-optimization-guide.html">Performance Optimization Guide</a></li><li><a href="./packages-web-src-showcase-readme.html">Care Commons Showcase Enhancements</a></li><li><a href="./rich-demo-implementation-plan.html">Rich Interactive Demo Implementation Plan</a></li><li><a href="./showcase-demo-data-implementation.html">Showcase Demo Data Implementation</a></li><li><a href="./showcase.html">Care Commons Platform - Interactive Showcase</a></li><li><a href="./showcase-part3-summary.html">Showcase Part 3: Multi-Role Experience Implementation</a></li><li><a href="./sync-integration-guide.html">Offline-First Sync Integration Guide</a></li><li><a href="./verticals-care-plans-tasks-demo.html">Care Plans & Tasks Library - Demo Guide</a></li><li><a href="./verticals-client-demographics-changelog.html">Changelog - Client & Demographics Management</a></li><li><a href="./verticals-client-demographics-examples.html">Client & Demographics - Usage Examples</a></li><li><a href="./verticals-client-demographics-migration.html">Migration Guide - Client & Demographics Management</a></li><li><a href="./verticals-scheduling-visits-wiring-guide.html">Scheduling Service Wiring Guide</a></li><li><a href="./verticals-shift-matching-demo.html">Shift Matching & Assignment Demo</a></li><li><a href="./verticals-time-tracking-evv-migration-guide.html">Migration Guide: TX/FL to Multi-State EVV</a></li><li><a href="./verticals-time-tracking-evv-multistate-guide.html">Multi-State EVV Integration Guide</a></li></ul></div><div class="nav-category">
      <h3>üèóÔ∏è Architecture & Deployment</h3>
      <ul><li><a href="./github-pull-request-template-mobile-pr-template.html">Mobile Pr Template</a></li><li><a href="./github-workflows-deployment-diagram.html">Deployment Flow Diagram</a></li><li><a href="./github-workflows-deployment-flow.html">Deployment Workflow Guide</a></li><li><a href="./autonomous-session-summary.html">Autonomous Development Session Summary</a></li><li><a href="./claude-layer-1-memory.html">Care Commons - Central Planner Vision & State</a></li><li><a href="./cloudflare-deployment.html">Cloudflare Deployment Guide</a></li><li><a href="./deployment-options.html">Deployment Options for Care Commons</a></li><li><a href="./deployment-quick-reference.html">Deployment Quick Reference</a></li><li><a href="./deployment-ready.html">‚úÖ Deployment Ready - Care Commons Platform</a></li><li><a href="./deployment.html">Cloud Deployment Guide</a></li><li><a href="./docs-compliance-index.html">State Compliance Documentation</a></li><li><a href="./docs-compliance-project-summary.html">State Compliance Documentation System - Project Summary</a></li><li><a href="./docs-deployment-setup-complete.html">Complete Deployment Setup Guide for Care Commons</a></li><li><a href="./docs-runbooks-manual-deployment.html">Manual Deployment Runbook</a></li><li><a href="./hardening-summary.html">Codebase Hardening Summary</a></li><li><a href="./implementation-complete-final.html">React Native Mobile Foundation - COMPLETE ‚úÖ</a></li><li><a href="./implementation-note.html">ML-Based Shift Matching Implementation</a></li><li><a href="./offline-first-architecture.html">Offline-First Architecture Implementation</a></li><li><a href="./offline-first-implementation-summary.html">Offline-First Architecture - Implementation Summary</a></li><li><a href="./packages-app-readme.html">Care Commons API Server</a></li><li><a href="./packages-core-src-compliance-readme.html">Multi-State Compliance System</a></li><li><a href="./packages-mobile-deployment-checklist.html">Mobile App Deployment Checklist</a></li><li><a href="./packages-mobile-implementation-summary.html">React Native Mobile Foundation - Implementation Summary</a></li><li><a href="./packages-mobile-mobile-foundation-summary.html">React Native Mobile Foundation - Implementation Summary</a></li><li><a href="./packages-shared-components-readme.html">@care-commons/shared-components</a></li><li><a href="./packages-web-architecture.html">Web Architecture</a></li><li><a href="./packages-web-readme.html">Care Commons Web UI</a></li><li><a href="./production-deployment.html">Production Deployment Guide - Vercel</a></li><li><a href="./pull-request-summary.html">Pull Request: Offline-First Synchronization System</a></li><li><a href="./tx-fl-implementation-summary.html">Texas and Florida State-Specific Implementation Summary</a></li><li><a href="./verticals-billing-invoicing-implementation-summary.html">Billing & Invoicing - Implementation Summary</a></li><li><a href="./verticals-care-plans-tasks-summary.html">Care Plans & Tasks Library - Implementation Summary</a></li><li><a href="./verticals-scheduling-visits-implementation.html">Implementation: Scheduling & Visit Management</a></li><li><a href="./verticals-scheduling-visits-summary.html">Scheduling & Visit Management - Implementation Summary</a></li><li><a href="./verticals-time-tracking-evv-changelog.html">Changelog</a></li><li><a href="./verticals-time-tracking-evv-evv-sync-integration.html">EVV Sync Integration Guide</a></li><li><a href="./verticals-time-tracking-evv-summary.html">Time Tracking & EVV Implementation Summary</a></li><li><a href="./web-implementation-summary.html">React Frontend Implementation Summary</a></li></ul></div><div class="nav-category">
      <h3>‚öôÔ∏è Implementation Details</h3>
      <ul><li><a href="./github-snyk-integration.html">Snyk Integration Policy</a></li><li><a href="./github-workflows-deployment-checklist.html">üöÄ Deployment Safety Checklist</a></li><li><a href="./agents.html">Agent Implementation Directives</a></li><li><a href="./api-cloudflare-workers-setup.html">Cloudflare Workers Setup (TODO)</a></li><li><a href="./auth-login-debugging.html">Authentication Login Failure Debugging Report</a></li><li><a href="./claude-0000-task-management-system-setup.html">Task 0000: Task Management System Setup</a></li><li><a href="./claude-0001-fix-caregiver-repository-type-errors.html">Task 0001: Fix Caregiver Repository Type Errors</a></li><li><a href="./claude-0003-create-state-compliance-service.html">Task 0003: Create State Compliance Service</a></li><li><a href="./claude-0004-implement-state-specific-evv-validation.html">Task 0004: Implement State-Specific EVV Validation</a></li><li><a href="./claude-0005-implement-visit-status-notifications.html">Task 0005: Implement Visit Status Notifications</a></li><li><a href="./claude-0006-build-clinical-documentation-foundation.html">Task 0006: Build Clinical Documentation Foundation</a></li><li><a href="./claude-0008-fix-evv-notification-recipients.html">Task 0008: Fix EVV Notification Recipients</a></li><li><a href="./claude-0009-integrate-family-engagement-with-services.html">Task 0009: Integrate Family Engagement with Client/Care Plan Services</a></li><li><a href="./claude-0010-implement-hhaexchange-evv-aggregator-integration.html">Task 0010: Implement HHAeXchange EVV Aggregator Integration</a></li><li><a href="./claude-0013-implement-holiday-filtering-in-schedule-service.html">Task 0013: Implement Holiday Filtering in Schedule Service</a></li><li><a href="./claude-0014-implement-mobile-push-notifications.html">Task 0014: Implement Mobile Push Notifications</a></li><li><a href="./claude-0015-implement-mobile-sync-status-screen.html">Task 0015: Implement Mobile Sync Status Screen</a></li><li><a href="./claude-0016-implement-mobile-e2e-testing.html">Task 0016: Implement Mobile E2E Testing for Critical Caregiver Workflows</a></li><li><a href="./claude-layer-1-input.html">Input</a></li><li><a href="./claude-layer-2-input-0003-mobile-offline-sync-status.html">Task 0003: Mobile Offline Sync Status Screen</a></li><li><a href="./claude-layer-2-input-0004-api-caregivers-me-endpoint.html">Task 0004: Caregiver Profile API Endpoint</a></li><li><a href="./claude-layer-2-input-0005-api-visits-my-visits-endpoint.html">Task 0005: My Visits API Endpoint</a></li><li><a href="./claude-layer-2-input-0006-mobile-visit-notes.html">Task 0006: Mobile Visit Notes Entry</a></li><li><a href="./claude-layer-2-input-0007-web-client-dashboard.html">Task 0007: Web Client Dashboard</a></li><li><a href="./claude-layer-2-input-0008-api-rate-limiting.html">Task 0008: API Rate Limiting Middleware</a></li><li><a href="./claude-layer-2-input-0009-error-monitoring-setup.html">Task 0009: Error Monitoring and Logging</a></li><li><a href="./claude-layer-2-input-0010-database-backup-strategy.html">Task 0010: Database Backup and Recovery</a></li><li><a href="./claude-layer-2-input-0011-mobile-biometric-auth.html">Task 0011: Mobile Biometric Authentication</a></li><li><a href="./claude-layer-2-input-0012-api-documentation.html">Task 0012: API Documentation with OpenAPI</a></li><li><a href="./claude-layer-2-input-0013-web-coordinator-onboarding.html">Task 0013: Coordinator Onboarding Flow</a></li><li><a href="./claude-layer-2-input-0014-mobile-push-notifications.html">Task 0014: Mobile Push Notifications</a></li><li><a href="./claude-layer-2-input-0015-testing-improvements.html">Task 0015: Test Coverage Improvements</a></li><li><a href="./claude-layer-2-instructions.html">INSTRUCTIONS</a></li><li><a href="./cli-tools-installed.html">‚úÖ CLI Tools Installed & Ready</a></li><li><a href="./contributing.html">Contributing to Care Commons</a></li><li><a href="./cors-fix.html">CORS Fix for Vercel Deployments</a></li><li><a href="./create-mobile-pr.html">Create Mobile Foundation PR</a></li><li><a href="./database-environments.html">Database Environment Management</a></li><li><a href="./dev-setup.html">Development Setup Guide</a></li><li><a href="./docs-api-documentation.html">API Documentation</a></li><li><a href="./docs-compliance-template-changelog.html">[STATE NAME] Regulatory Changelog</a></li><li><a href="./docs-compliance-template-implementation.html">[STATE NAME] Compliance Implementation Guide</a></li><li><a href="./docs-compliance-template-requirements.html">[STATE NAME] Home Healthcare Compliance Requirements</a></li><li><a href="./docs-compliance-template-test-scenarios.html">[STATE NAME] Compliance Test Scenarios</a></li><li><a href="./docs-compliance-florida-changelog.html">Florida Regulatory Changelog</a></li><li><a href="./docs-compliance-florida-requirements.html">Florida Home Healthcare Compliance Requirements</a></li><li><a href="./docs-compliance-ohio-changelog.html">Ohio Compliance Changelog</a></li><li><a href="./docs-compliance-ohio-implementation.html">Ohio Compliance Implementation Guide</a></li><li><a href="./docs-compliance-ohio-requirements.html">Ohio Home Healthcare Compliance Requirements</a></li><li><a href="./docs-compliance-ohio-test-scenarios.html">Ohio Compliance Test Scenarios</a></li><li class="more-docs">+ 59 more documents</li></ul></div>
      </nav>
    </aside>
    <main class="content">
      <div class="breadcrumbs">
      <a href="./index.html">Home</a> / 
      <span>üöÄ Getting Started</span> / 
      <span>Care Commons: End-to-End Testing Guide</span>
    </div>
      <article class="markdown-content">
        <h1>Care Commons: End-to-End Testing Guide</h1>
<h2>Overview</h2>
<p>This directory contains comprehensive end-to-end (E2E) tests for Care Commons using <a href="https://playwright.dev/">Playwright</a>. These tests validate critical user workflows across multiple states and compliance requirements.</p>
<h2>Table of Contents</h2>
<ul>
<li><a href="#quick-start">Quick Start</a></li>
<li><a href="#test-structure">Test Structure</a></li>
<li><a href="#running-tests">Running Tests</a></li>
<li><a href="#writing-tests">Writing Tests</a></li>
<li><a href="#test-data--seeding">Test Data &amp; Seeding</a></li>
<li><a href="#page-object-models">Page Object Models</a></li>
<li><a href="#cicd-integration">CI/CD Integration</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
</ul>
<hr>
<h2>Quick Start</h2>
<h3>Prerequisites</h3>
<ul>
<li>Node.js 22.x</li>
<li>PostgreSQL 15+</li>
<li>npm 10.9.0+</li>
</ul>
<h3>Installation</h3>
<pre><code class="language-bash"># Install dependencies (includes Playwright)
npm install

# Install Playwright browsers
npx playwright install

# Set up test database
createdb care_commons_e2e_test
npm run db:migrate
</code></pre>
<h3>Run All Tests</h3>
<pre><code class="language-bash">npm run test:e2e
</code></pre>
<h3>Run Specific Browser</h3>
<pre><code class="language-bash">npm run test:e2e:chromium
npm run test:e2e:firefox
npm run test:e2e:webkit
</code></pre>
<h3>Debug Mode</h3>
<pre><code class="language-bash">npm run test:e2e:debug
</code></pre>
<h3>UI Mode (Interactive)</h3>
<pre><code class="language-bash">npm run test:e2e:ui
</code></pre>
<hr>
<h2>Test Structure</h2>
<pre><code>e2e/
‚îú‚îÄ‚îÄ tests/                          # Test suites
‚îÇ   ‚îú‚îÄ‚îÄ visit-lifecycle.spec.ts    # Visit workflow tests
‚îÇ   ‚îú‚îÄ‚îÄ evv-compliance.spec.ts     # State-specific EVV tests
‚îÇ   ‚îî‚îÄ‚îÄ caregiver-assignment.spec.ts # Assignment validation tests
‚îú‚îÄ‚îÄ pages/                          # Page Object Models
‚îÇ   ‚îú‚îÄ‚îÄ BasePage.ts                 # Base page with common methods
‚îÇ   ‚îú‚îÄ‚îÄ VisitListPage.ts            # Visit list page
‚îÇ   ‚îú‚îÄ‚îÄ VisitDetailPage.ts          # Visit detail page
‚îÇ   ‚îú‚îÄ‚îÄ ScheduleVisitPage.ts        # Schedule visit form
‚îÇ   ‚îú‚îÄ‚îÄ EVVRecordPage.ts            # EVV record view
‚îÇ   ‚îî‚îÄ‚îÄ CaregiverSelectionModal.ts  # Caregiver assignment
‚îú‚îÄ‚îÄ fixtures/                       # Test fixtures
‚îÇ   ‚îî‚îÄ‚îÄ auth.fixture.ts             # Authentication helpers
‚îú‚îÄ‚îÄ setup/                          # Test setup &amp; teardown
‚îÇ   ‚îú‚îÄ‚îÄ global-setup.ts             # Pre-test setup
‚îÇ   ‚îú‚îÄ‚îÄ global-teardown.ts          # Post-test cleanup
‚îÇ   ‚îú‚îÄ‚îÄ test-database.ts            # Database utilities
‚îÇ   ‚îî‚îÄ‚îÄ seeds/                      # Test data seeds
‚îÇ       ‚îú‚îÄ‚îÄ visit-lifecycle.seed.ts
‚îÇ       ‚îú‚îÄ‚îÄ texas-visit.seed.ts
‚îÇ       ‚îú‚îÄ‚îÄ florida-visit-mco.seed.ts
‚îÇ       ‚îî‚îÄ‚îÄ ohio-visit.seed.ts
‚îî‚îÄ‚îÄ README.md                       # This file
</code></pre>
<hr>
<h2>Running Tests</h2>
<h3>All Tests</h3>
<pre><code class="language-bash">npm run test:e2e
</code></pre>
<h3>Specific Test File</h3>
<pre><code class="language-bash">npx playwright test visit-lifecycle.spec.ts
</code></pre>
<h3>Specific Test Case</h3>
<pre><code class="language-bash">npx playwright test -g &quot;should complete full visit lifecycle&quot;
</code></pre>
<h3>By Project (Browser)</h3>
<pre><code class="language-bash">npm run test:e2e:chromium    # Desktop Chrome
npm run test:e2e:firefox     # Desktop Firefox
npm run test:e2e:webkit      # Desktop Safari
npm run test:e2e:mobile      # Mobile Chrome + Safari
</code></pre>
<h3>With UI (Interactive Mode)</h3>
<pre><code class="language-bash">npm run test:e2e:ui
</code></pre>
<h3>Debug Mode</h3>
<pre><code class="language-bash">npm run test:e2e:debug
</code></pre>
<h3>Generate Report</h3>
<pre><code class="language-bash">npm run test:e2e:report
</code></pre>
<h3>Environment Variables</h3>
<pre><code class="language-bash"># Override database URL
E2E_DATABASE_URL=postgresql://localhost/my_test_db npm run test:e2e

# Override base URL
E2E_BASE_URL=http://localhost:4000 npm run test:e2e

# Drop database after tests
E2E_DROP_DATABASE=true npm run test:e2e
</code></pre>
<hr>
<h2>Writing Tests</h2>
<h3>Basic Test Structure</h3>
<pre><code class="language-typescript">import { test, expect } from &#39;../fixtures/auth.fixture.js&#39;;
import { VisitDetailPage } from &#39;../pages/VisitDetailPage.js&#39;;
import { TestDatabase } from &#39;../setup/test-database.js&#39;;

test.describe(&#39;My Test Suite&#39;, () =&gt; {
  test.beforeAll(async () =&gt; {
    await TestDatabase.setup();
  });

  test.afterAll(async () =&gt; {
    await TestDatabase.teardown();
  });

  test.beforeEach(async () =&gt; {
    await TestDatabase.cleanup();
    await TestDatabase.seed(&#39;my-scenario&#39;);
  });

  test(&#39;should do something&#39;, async ({ authenticatedPage }) =&gt; {
    const visitPage = new VisitDetailPage(authenticatedPage);
    await visitPage.goToVisit(&#39;visit-001&#39;);
    await visitPage.clockIn();
    await visitPage.assertStatus(&#39;IN_PROGRESS&#39;);
  });
});
</code></pre>
<h3>Using Authentication Fixtures</h3>
<pre><code class="language-typescript">// Use pre-configured coordinator user
test(&#39;coordinator workflow&#39;, async ({ authenticatedPage, coordinatorUser }) =&gt; {
  // authenticatedPage is already authenticated as coordinator
});

// Use admin user
test(&#39;admin workflow&#39;, async ({ page, adminUser, createAuthenticatedPage }) =&gt; {
  const adminPage = await createAuthenticatedPage(page, adminUser);
  // adminPage is authenticated as admin
});

// Use caregiver user
test(&#39;caregiver workflow&#39;, async ({ page, caregiverUser, createAuthenticatedPage }) =&gt; {
  const caregiverPage = await createAuthenticatedPage(page, caregiverUser);
});
</code></pre>
<h3>Using Page Objects</h3>
<pre><code class="language-typescript">import { VisitListPage } from &#39;../pages/VisitListPage.js&#39;;
import { VisitDetailPage } from &#39;../pages/VisitDetailPage.js&#39;;

test(&#39;navigate to visit&#39;, async ({ authenticatedPage }) =&gt; {
  const listPage = new VisitListPage(authenticatedPage);
  await listPage.goToVisitList();
  await listPage.filterByStatus(&#39;SCHEDULED&#39;);
  await listPage.clickVisit(&#39;John Doe&#39;);

  const detailPage = new VisitDetailPage(authenticatedPage);
  await detailPage.assertStatus(&#39;SCHEDULED&#39;);
});
</code></pre>
<h3>Mocking Geolocation</h3>
<pre><code class="language-typescript">test(&#39;with GPS&#39;, async ({ authenticatedPage }) =&gt; {
  // Set geolocation
  await authenticatedPage.context().setGeolocation({
    latitude: 30.2672,
    longitude: -97.7431,
    accuracy: 10,
  });
  await authenticatedPage.context().grantPermissions([&#39;geolocation&#39;]);

  // Now proceed with test
  await visitPage.clockIn();
});
</code></pre>
<hr>
<h2>Test Data &amp; Seeding</h2>
<h3>Creating Seed Files</h3>
<p>Create a new seed file in <code>e2e/setup/seeds/</code>:</p>
<pre><code class="language-typescript">// e2e/setup/seeds/my-scenario.seed.ts
import { Database } from &#39;../../../packages/core/src/db/connection.js&#39;;

export async function seedDatabase(db: Database): Promise&lt;void&gt; {
  console.log(&#39;Seeding my scenario...&#39;);

  // Insert test data
  await db.query(
    `INSERT INTO clients (id, organization_id, first_name, last_name, ...)
     VALUES ($1, $2, $3, $4, ...)`,
    [&#39;client-id&#39;, &#39;org-id&#39;, &#39;John&#39;, &#39;Doe&#39;, ...]
  );

  console.log(&#39;‚úÖ My scenario seeded&#39;);
}
</code></pre>
<h3>Using Seeds in Tests</h3>
<pre><code class="language-typescript">test.beforeEach(async () =&gt; {
  await TestDatabase.cleanup();
  await TestDatabase.seed(&#39;my-scenario&#39;); // Loads my-scenario.seed.ts
});
</code></pre>
<h3>State-Specific Seeds</h3>
<p>We provide pre-built seeds for state-specific testing:</p>
<ul>
<li><code>visit-lifecycle.seed.ts</code> - Basic visit workflow</li>
<li><code>texas-visit.seed.ts</code> - Texas EVV with HHAeXchange</li>
<li><code>florida-visit-mco.seed.ts</code> - Florida MCO with signature requirements</li>
<li><code>ohio-visit.seed.ts</code> - Ohio with Sandata</li>
<li><code>texas-caregiver-no-emr.seed.ts</code> - Texas caregiver missing EMR check</li>
<li><code>florida-caregiver-valid-screening.seed.ts</code> - Florida Level 2 screening</li>
</ul>
<hr>
<h2>Page Object Models</h2>
<h3>BasePage Methods</h3>
<p>All page objects extend <code>BasePage</code> with common utilities:</p>
<pre><code class="language-typescript">// Navigation
await page.goto(&#39;/path&#39;);
await page.waitForPageLoad();

// Interaction
await page.clickButton(&#39;Save&#39;);
await page.fillInput(&#39;Name&#39;, &#39;John Doe&#39;);
await page.selectOption(&#39;State&#39;, &#39;TX&#39;);

// Waiting
await page.waitForToast(&#39;Saved successfully&#39;);
await page.waitForErrorToast(&#39;Validation failed&#39;);

// Assertions
await page.assertUrl(&#39;/visits/123&#39;);
await page.assertTitle(&#39;Visit Details&#39;);

// Utilities
await page.screenshot(&#39;debug-screenshot&#39;);
await page.reload();
</code></pre>
<h3>Creating New Page Objects</h3>
<pre><code class="language-typescript">// e2e/pages/MyPage.ts
import { BasePage } from &#39;./BasePage.js&#39;;
import { Locator } from &#39;@playwright/test&#39;;

export class MyPage extends BasePage {
  readonly myButton: Locator;

  constructor(page: Page) {
    super(page);
    this.myButton = page.getByRole(&#39;button&#39;, { name: &#39;My Button&#39; });
  }

  async clickMyButton(): Promise&lt;void&gt; {
    await this.myButton.click();
    await this.waitForPageLoad();
  }
}
</code></pre>
<hr>
<h2>CI/CD Integration</h2>
<h3>GitHub Actions</h3>
<p>E2E tests run automatically on:</p>
<ul>
<li>Pull requests to <code>main</code>, <code>preview</code>, <code>develop</code></li>
<li>Push to <code>main</code>, <code>preview</code>, <code>develop</code></li>
<li>Nightly at 2 AM UTC</li>
<li>Manual workflow dispatch</li>
</ul>
<h3>Workflow Configuration</h3>
<p>See <code>.github/workflows/e2e-tests.yml</code></p>
<p>Tests run in parallel across:</p>
<ul>
<li>Chromium (Desktop)</li>
<li>Firefox (Desktop)</li>
<li>WebKit (Desktop)</li>
<li>Mobile Chrome</li>
<li>Mobile Safari</li>
</ul>
<h3>Artifacts</h3>
<p>On test failure, the following are uploaded:</p>
<ul>
<li>HTML test reports (30 days retention)</li>
<li>Screenshots (7 days retention)</li>
<li>Videos (7 days retention)</li>
</ul>
<hr>
<h2>Troubleshooting</h2>
<h3>Test Database Issues</h3>
<pre><code class="language-bash"># Reset test database
dropdb care_commons_e2e_test
createdb care_commons_e2e_test
npm run db:migrate

# Check database connection
psql -d care_commons_e2e_test -c &quot;SELECT 1&quot;
</code></pre>
<h3>Browser Installation Issues</h3>
<pre><code class="language-bash"># Reinstall browsers
npx playwright install --with-deps

# Install specific browser
npx playwright install chromium
</code></pre>
<h3>Timeout Errors</h3>
<pre><code class="language-typescript">// Increase timeout for specific test
test(&#39;slow test&#39;, async ({ authenticatedPage }) =&gt; {
  test.setTimeout(180000); // 3 minutes

  // ... test code
});
</code></pre>
<h3>Flaky Tests</h3>
<pre><code class="language-typescript">// Retry failed tests
test.describe.configure({ retries: 2 });

// Or in playwright.config.ts:
retries: process.env[&#39;CI&#39;] ? 2 : 0,
</code></pre>
<h3>Debug with Trace</h3>
<pre><code class="language-bash"># Run with trace
npx playwright test --trace on

# View trace
npx playwright show-trace trace.zip
</code></pre>
<h3>Inspect Element</h3>
<pre><code class="language-typescript">// Pause execution to inspect
await page.pause();
</code></pre>
<hr>
<h2>Best Practices</h2>
<h3>1. Use Page Objects</h3>
<p>‚úÖ <strong>Good:</strong></p>
<pre><code class="language-typescript">const visitPage = new VisitDetailPage(page);
await visitPage.clockIn();
</code></pre>
<p>‚ùå <strong>Bad:</strong></p>
<pre><code class="language-typescript">await page.getByRole(&#39;button&#39;, { name: &#39;Clock In&#39; }).click();
</code></pre>
<h3>2. Seed Data Per Test</h3>
<p>‚úÖ <strong>Good:</strong></p>
<pre><code class="language-typescript">test.beforeEach(async () =&gt; {
  await TestDatabase.cleanup();
  await TestDatabase.seed(&#39;visit-lifecycle&#39;);
});
</code></pre>
<p>‚ùå <strong>Bad:</strong></p>
<pre><code class="language-typescript">// Sharing data between tests (causes flakiness)
</code></pre>
<h3>3. Descriptive Test Names</h3>
<p>‚úÖ <strong>Good:</strong></p>
<pre><code class="language-typescript">test(&#39;should prevent clock-in outside geofence&#39;, async () =&gt; {});
</code></pre>
<p>‚ùå <strong>Bad:</strong></p>
<pre><code class="language-typescript">test(&#39;test1&#39;, async () =&gt; {});
</code></pre>
<h3>4. Assertions</h3>
<p>‚úÖ <strong>Good:</strong></p>
<pre><code class="language-typescript">await expect(page.locator(&#39;[data-testid=&quot;status&quot;]&#39;)).toHaveText(&#39;COMPLETED&#39;);
</code></pre>
<p>‚ùå <strong>Bad:</strong></p>
<pre><code class="language-typescript">const text = await page.locator(&#39;[data-testid=&quot;status&quot;]&#39;).textContent();
expect(text).toBe(&#39;COMPLETED&#39;); // No auto-retry
</code></pre>
<hr>
<h2>Test Coverage</h2>
<h3>Critical Workflows</h3>
<ul>
<li>‚úÖ Visit lifecycle (schedule ‚Üí clock in ‚Üí complete ‚Üí clock out)</li>
<li>‚úÖ EVV compliance (TX, FL, OH state-specific)</li>
<li>‚úÖ Caregiver assignment (multi-state validation)</li>
<li>‚úÖ GPS verification and geofencing</li>
<li>‚úÖ Task completion tracking</li>
<li>‚úÖ State-specific credential requirements</li>
</ul>
<h3>State Coverage</h3>
<ul>
<li>‚úÖ Texas (EMR clearance, HHAeXchange, VMUR)</li>
<li>‚úÖ Florida (Level 2 screening, MCO signatures)</li>
<li>‚úÖ Ohio (STNA certification, Sandata)</li>
<li>‚ö†Ô∏è Pennsylvania (partial)</li>
<li>‚ö†Ô∏è Georgia (partial)</li>
<li>‚ö†Ô∏è North Carolina (planned)</li>
<li>‚ö†Ô∏è Arizona (planned)</li>
</ul>
<hr>
<h2>Contributing</h2>
<h3>Adding New Tests</h3>
<ol>
<li>Create test file in <code>e2e/tests/</code></li>
<li>Create seed data in <code>e2e/setup/seeds/</code></li>
<li>Add page objects if needed in <code>e2e/pages/</code></li>
<li>Document new scenarios in this README</li>
<li>Run tests locally: <code>npm run test:e2e</code></li>
<li>Verify CI passes on PR</li>
</ol>
<h3>Adding State-Specific Tests</h3>
<ol>
<li>Research state requirements (EVV aggregator, credentials, etc.)</li>
<li>Create seed file: <code>e2e/setup/seeds/{state}-visit.seed.ts</code></li>
<li>Add test cases in <code>e2e/tests/evv-compliance.spec.ts</code></li>
<li>Add to state coverage section above</li>
</ol>
<hr>
<h2>Resources</h2>
<ul>
<li><a href="https://playwright.dev/">Playwright Documentation</a></li>
<li><a href="https://playwright.dev/docs/best-practices">Playwright Best Practices</a></li>
<li><a href="../packages/web/ARCHITECTURE.md">Care Commons Architecture</a></li>
<li><a href="../verticals/time-tracking-evv/README.md">Care Commons EVV Implementation</a></li>
</ul>
<hr>
<p><strong>Care Commons</strong> - Shared care software, community owned
Brought to you by <a href="https://neighborhoodlab.org">Neighborhood Lab</a></p>

      </article>
      <footer class="content-footer">
        <p>
          <strong>Care Commons</strong> - Shared care software, community owned<br>
          Brought to you by <a href="https://neighborhoodlab.org" target="_blank">Neighborhood Lab</a>
        </p>
      </footer>
    </main>
  </div>
</body>
</html>