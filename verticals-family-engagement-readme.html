<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Family Engagement Platform (Consolidated) - Care Commons Documentation</title>
  <meta name="description" content="Comprehensive documentation for Care Commons - Shared care software, community owned">
  <link rel="stylesheet" href="/styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      hljs.highlightAll();
      
      // Mobile menu toggle
      const menuToggle = document.querySelector('.menu-toggle');
      const sidebar = document.querySelector('.sidebar');
      if (menuToggle && sidebar) {
        menuToggle.addEventListener('click', () => {
          sidebar.classList.toggle('open');
        });
      }
      
      // Search functionality
      const searchInput = document.getElementById('search-input');
      const searchResults = document.getElementById('search-results');
      
      if (searchInput && searchResults) {
        searchInput.addEventListener('input', (e) => {
          const query = e.target.value.toLowerCase();
          if (query.length < 2) {
            searchResults.innerHTML = '';
            searchResults.style.display = 'none';
            return;
          }
          
          // Simple search through navigation items
          const navItems = document.querySelectorAll('.sidebar a');
          const matches = Array.from(navItems)
            .filter(item => item.textContent.toLowerCase().includes(query))
            .slice(0, 10);
          
          if (matches.length > 0) {
            searchResults.innerHTML = matches
              .map(item => `<a href="${item.href}" class="search-result">${item.textContent}</a>`)
              .join('');
            searchResults.style.display = 'block';
          } else {
            searchResults.innerHTML = '<div class="search-result no-results">No results found</div>';
            searchResults.style.display = 'block';
          }
        });
        
        // Hide results when clicking outside
        document.addEventListener('click', (e) => {
          if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
            searchResults.style.display = 'none';
          }
        });
      }
    });
  </script>
</head>
<body>
  <div class="container">
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1><a href="/index.html">Care Commons Docs</a></h1>
        <button class="menu-toggle" aria-label="Toggle menu">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
      <div class="search-container">
        <input type="text" id="search-input" placeholder="Search documentation..." />
        <div id="search-results"></div>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-category">
      <h3>üöÄ Getting Started</h3>
      <ul><li><a href="/api-readme.html">API Directory - Vercel Serverless Functions</a></li><li><a href="/claude-layer-2-input-readme.html">Layer 2 Implementation Tasks</a></li><li><a href="/claude-readme.html">Claude Autonomous Task Management System</a></li><li><a href="/database-quickstart.html">Database Quick Start</a></li><li><a href="/demo-quickstart.html">Rich Interactive Demo - Quick Start Guide</a></li><li><a href="/deployment-quick-start.html">Deployment Quick Start Guide</a></li><li><a href="/deployment-quickstart.html">Deployment Quick Start</a></li><li><a href="/docs-compliance-readme.html">State Compliance Documentation</a></li><li><a href="/e2e-readme.html">Care Commons: End-to-End Testing Guide</a></li><li><a href="/packages-mobile-quickstart-mobile.html">Mobile App Quick Start Guide</a></li><li><a href="/packages-mobile-quickstart.html">Mobile App Quickstart Guide</a></li><li><a href="/packages-web-quickstart.html">Quick Start Guide</a></li><li><a href="/readme.html">Care Commons</a></li><li><a href="/scripts-readme.html">Care Commons Deployment Scripts</a></li><li><a href="/showcase-quick-start.html">Showcase Quick Start Guide</a></li><li><a href="/showcase-readme.html">Care Commons Showcase</a></li><li><a href="/vercel-quickstart.html">Vercel Environment Setup - Quick Start</a></li><li><a href="/verticals-analytics-reporting-readme.html">Analytics & Reporting Vertical</a></li><li><a href="/verticals-billing-invoicing-readme.html">Billing & Invoicing</a></li><li><a href="/verticals-care-plans-tasks-quickstart.html">Care Plans & Tasks Library - Quickstart</a></li><li><a href="/verticals-care-plans-tasks-readme.html">Care Plans & Tasks Library</a></li><li><a href="/verticals-caregiver-staff-quickstart.html">Caregiver & Staff Management - Quick Start</a></li><li><a href="/verticals-caregiver-staff-readme.html">Caregiver & Staff Management</a></li><li><a href="/verticals-client-demographics-readme.html">Client & Demographics Management</a></li><li><a href="/verticals-family-engagement-readme.html">Family Engagement Platform (Consolidated)</a></li><li><a href="/verticals-payroll-processing-readme.html">Payroll Processing</a></li><li><a href="/verticals-quality-assurance-audits-readme.html">Quality Assurance & Audits Vertical</a></li><li><a href="/verticals-scheduling-visits-quickstart.html">Quickstart: Scheduling & Visit Management</a></li><li><a href="/verticals-scheduling-visits-readme.html">Scheduling & Visit Management</a></li><li><a href="/verticals-shift-matching-readme.html">Shift Matching & Assignment</a></li><li><a href="/verticals-time-tracking-evv-quickstart.html">Time Tracking & EVV - Quick Start Guide</a></li><li><a href="/verticals-time-tracking-evv-readme.html">Time Tracking & Electronic Visit Verification (EVV)</a></li></ul></div><div class="nav-category">
      <h3>üìñ User Guides</h3>
      <ul><li><a href="/claude-0002-fix-client-demographics-api-error.html">Task 0002: Fix Client Demographics API Type Error</a></li><li><a href="/docs-deployment-guide.html">Care Commons Deployment Guide</a></li><li><a href="/docs-performance-optimization-guide.html">Performance Optimization Guide</a></li><li><a href="/packages-web-src-showcase-readme.html">Care Commons Showcase Enhancements</a></li><li><a href="/rich-demo-implementation-plan.html">Rich Interactive Demo Implementation Plan</a></li><li><a href="/showcase-demo-data-implementation.html">Showcase Demo Data Implementation</a></li><li><a href="/showcase.html">Care Commons Platform - Interactive Showcase</a></li><li><a href="/showcase-part3-summary.html">Showcase Part 3: Multi-Role Experience Implementation</a></li><li><a href="/sync-integration-guide.html">Offline-First Sync Integration Guide</a></li><li><a href="/verticals-care-plans-tasks-demo.html">Care Plans & Tasks Library - Demo Guide</a></li><li><a href="/verticals-client-demographics-changelog.html">Changelog - Client & Demographics Management</a></li><li><a href="/verticals-client-demographics-examples.html">Client & Demographics - Usage Examples</a></li><li><a href="/verticals-client-demographics-migration.html">Migration Guide - Client & Demographics Management</a></li><li><a href="/verticals-scheduling-visits-wiring-guide.html">Scheduling Service Wiring Guide</a></li><li><a href="/verticals-shift-matching-demo.html">Shift Matching & Assignment Demo</a></li><li><a href="/verticals-time-tracking-evv-migration-guide.html">Migration Guide: TX/FL to Multi-State EVV</a></li><li><a href="/verticals-time-tracking-evv-multistate-guide.html">Multi-State EVV Integration Guide</a></li></ul></div><div class="nav-category">
      <h3>üèóÔ∏è Architecture & Deployment</h3>
      <ul><li><a href="/github-pull-request-template-mobile-pr-template.html">Mobile Pr Template</a></li><li><a href="/github-workflows-deployment-diagram.html">Deployment Flow Diagram</a></li><li><a href="/github-workflows-deployment-flow.html">Deployment Workflow Guide</a></li><li><a href="/autonomous-session-summary.html">Autonomous Development Session Summary</a></li><li><a href="/claude-layer-1-memory.html">Care Commons - Central Planner Vision & State</a></li><li><a href="/cloudflare-deployment.html">Cloudflare Deployment Guide</a></li><li><a href="/deployment-options.html">Deployment Options for Care Commons</a></li><li><a href="/deployment-quick-reference.html">Deployment Quick Reference</a></li><li><a href="/deployment-ready.html">‚úÖ Deployment Ready - Care Commons Platform</a></li><li><a href="/deployment.html">Cloud Deployment Guide</a></li><li><a href="/docs-compliance-index.html">State Compliance Documentation</a></li><li><a href="/docs-compliance-project-summary.html">State Compliance Documentation System - Project Summary</a></li><li><a href="/docs-deployment-setup-complete.html">Complete Deployment Setup Guide for Care Commons</a></li><li><a href="/docs-runbooks-manual-deployment.html">Manual Deployment Runbook</a></li><li><a href="/hardening-summary.html">Codebase Hardening Summary</a></li><li><a href="/implementation-complete-final.html">React Native Mobile Foundation - COMPLETE ‚úÖ</a></li><li><a href="/implementation-note.html">ML-Based Shift Matching Implementation</a></li><li><a href="/offline-first-architecture.html">Offline-First Architecture Implementation</a></li><li><a href="/offline-first-implementation-summary.html">Offline-First Architecture - Implementation Summary</a></li><li><a href="/packages-app-readme.html">Care Commons API Server</a></li><li><a href="/packages-core-src-compliance-readme.html">Multi-State Compliance System</a></li><li><a href="/packages-mobile-deployment-checklist.html">Mobile App Deployment Checklist</a></li><li><a href="/packages-mobile-implementation-summary.html">React Native Mobile Foundation - Implementation Summary</a></li><li><a href="/packages-mobile-mobile-foundation-summary.html">React Native Mobile Foundation - Implementation Summary</a></li><li><a href="/packages-shared-components-readme.html">@care-commons/shared-components</a></li><li><a href="/packages-web-architecture.html">Web Architecture</a></li><li><a href="/packages-web-readme.html">Care Commons Web UI</a></li><li><a href="/production-deployment.html">Production Deployment Guide - Vercel</a></li><li><a href="/pull-request-summary.html">Pull Request: Offline-First Synchronization System</a></li><li><a href="/tx-fl-implementation-summary.html">Texas and Florida State-Specific Implementation Summary</a></li><li><a href="/verticals-billing-invoicing-implementation-summary.html">Billing & Invoicing - Implementation Summary</a></li><li><a href="/verticals-care-plans-tasks-summary.html">Care Plans & Tasks Library - Implementation Summary</a></li><li><a href="/verticals-scheduling-visits-implementation.html">Implementation: Scheduling & Visit Management</a></li><li><a href="/verticals-scheduling-visits-summary.html">Scheduling & Visit Management - Implementation Summary</a></li><li><a href="/verticals-time-tracking-evv-changelog.html">Changelog</a></li><li><a href="/verticals-time-tracking-evv-evv-sync-integration.html">EVV Sync Integration Guide</a></li><li><a href="/verticals-time-tracking-evv-summary.html">Time Tracking & EVV Implementation Summary</a></li><li><a href="/web-implementation-summary.html">React Frontend Implementation Summary</a></li></ul></div><div class="nav-category">
      <h3>‚öôÔ∏è Implementation Details</h3>
      <ul><li><a href="/github-snyk-integration.html">Snyk Integration Policy</a></li><li><a href="/github-workflows-deployment-checklist.html">üöÄ Deployment Safety Checklist</a></li><li><a href="/agents.html">Agent Implementation Directives</a></li><li><a href="/api-cloudflare-workers-setup.html">Cloudflare Workers Setup (TODO)</a></li><li><a href="/auth-login-debugging.html">Authentication Login Failure Debugging Report</a></li><li><a href="/claude-0000-task-management-system-setup.html">Task 0000: Task Management System Setup</a></li><li><a href="/claude-0001-fix-caregiver-repository-type-errors.html">Task 0001: Fix Caregiver Repository Type Errors</a></li><li><a href="/claude-0003-create-state-compliance-service.html">Task 0003: Create State Compliance Service</a></li><li><a href="/claude-0004-implement-state-specific-evv-validation.html">Task 0004: Implement State-Specific EVV Validation</a></li><li><a href="/claude-0005-implement-visit-status-notifications.html">Task 0005: Implement Visit Status Notifications</a></li><li><a href="/claude-0006-build-clinical-documentation-foundation.html">Task 0006: Build Clinical Documentation Foundation</a></li><li><a href="/claude-0008-fix-evv-notification-recipients.html">Task 0008: Fix EVV Notification Recipients</a></li><li><a href="/claude-0009-integrate-family-engagement-with-services.html">Task 0009: Integrate Family Engagement with Client/Care Plan Services</a></li><li><a href="/claude-0010-implement-hhaexchange-evv-aggregator-integration.html">Task 0010: Implement HHAeXchange EVV Aggregator Integration</a></li><li><a href="/claude-0013-implement-holiday-filtering-in-schedule-service.html">Task 0013: Implement Holiday Filtering in Schedule Service</a></li><li><a href="/claude-0014-implement-mobile-push-notifications.html">Task 0014: Implement Mobile Push Notifications</a></li><li><a href="/claude-0015-implement-mobile-sync-status-screen.html">Task 0015: Implement Mobile Sync Status Screen</a></li><li><a href="/claude-0016-implement-mobile-e2e-testing.html">Task 0016: Implement Mobile E2E Testing for Critical Caregiver Workflows</a></li><li><a href="/claude-layer-1-input.html">Input</a></li><li><a href="/claude-layer-2-input-0003-mobile-offline-sync-status.html">Task 0003: Mobile Offline Sync Status Screen</a></li><li><a href="/claude-layer-2-input-0004-api-caregivers-me-endpoint.html">Task 0004: Caregiver Profile API Endpoint</a></li><li><a href="/claude-layer-2-input-0005-api-visits-my-visits-endpoint.html">Task 0005: My Visits API Endpoint</a></li><li><a href="/claude-layer-2-input-0006-mobile-visit-notes.html">Task 0006: Mobile Visit Notes Entry</a></li><li><a href="/claude-layer-2-input-0007-web-client-dashboard.html">Task 0007: Web Client Dashboard</a></li><li><a href="/claude-layer-2-input-0008-api-rate-limiting.html">Task 0008: API Rate Limiting Middleware</a></li><li><a href="/claude-layer-2-input-0009-error-monitoring-setup.html">Task 0009: Error Monitoring and Logging</a></li><li><a href="/claude-layer-2-input-0010-database-backup-strategy.html">Task 0010: Database Backup and Recovery</a></li><li><a href="/claude-layer-2-input-0011-mobile-biometric-auth.html">Task 0011: Mobile Biometric Authentication</a></li><li><a href="/claude-layer-2-input-0012-api-documentation.html">Task 0012: API Documentation with OpenAPI</a></li><li><a href="/claude-layer-2-input-0013-web-coordinator-onboarding.html">Task 0013: Coordinator Onboarding Flow</a></li><li><a href="/claude-layer-2-input-0014-mobile-push-notifications.html">Task 0014: Mobile Push Notifications</a></li><li><a href="/claude-layer-2-input-0015-testing-improvements.html">Task 0015: Test Coverage Improvements</a></li><li><a href="/claude-layer-2-instructions.html">INSTRUCTIONS</a></li><li><a href="/cli-tools-installed.html">‚úÖ CLI Tools Installed & Ready</a></li><li><a href="/contributing.html">Contributing to Care Commons</a></li><li><a href="/cors-fix.html">CORS Fix for Vercel Deployments</a></li><li><a href="/create-mobile-pr.html">Create Mobile Foundation PR</a></li><li><a href="/database-environments.html">Database Environment Management</a></li><li><a href="/dev-setup.html">Development Setup Guide</a></li><li><a href="/docs-api-documentation.html">API Documentation</a></li><li><a href="/docs-compliance-template-changelog.html">[STATE NAME] Regulatory Changelog</a></li><li><a href="/docs-compliance-template-implementation.html">[STATE NAME] Compliance Implementation Guide</a></li><li><a href="/docs-compliance-template-requirements.html">[STATE NAME] Home Healthcare Compliance Requirements</a></li><li><a href="/docs-compliance-template-test-scenarios.html">[STATE NAME] Compliance Test Scenarios</a></li><li><a href="/docs-compliance-florida-changelog.html">Florida Regulatory Changelog</a></li><li><a href="/docs-compliance-florida-requirements.html">Florida Home Healthcare Compliance Requirements</a></li><li><a href="/docs-compliance-ohio-changelog.html">Ohio Compliance Changelog</a></li><li><a href="/docs-compliance-ohio-implementation.html">Ohio Compliance Implementation Guide</a></li><li><a href="/docs-compliance-ohio-requirements.html">Ohio Home Healthcare Compliance Requirements</a></li><li><a href="/docs-compliance-ohio-test-scenarios.html">Ohio Compliance Test Scenarios</a></li><li class="more-docs">+ 59 more documents</li></ul></div>
      </nav>
    </aside>
    <main class="content">
      <div class="breadcrumbs">
      <a href="/index.html">Home</a> / 
      <span>üöÄ Getting Started</span> / 
      <span>Family Engagement Platform (Consolidated)</span>
    </div>
      <article class="markdown-content">
        <h1>Family Engagement Platform (Consolidated)</h1>
<blockquote>
<p><strong>Status</strong>: ‚úÖ <strong>Consolidated &amp; Unified</strong> | ‚úÖ Backend Complete | üöß Frontend Pending | üìù Testing Needed</p>
</blockquote>
<hr>
<h2>üéâ Consolidation Complete</h2>
<p><strong>This vertical has been consolidated</strong> from three previously fragmented verticals (Parts 3, 4, 5, 6):</p>
<ul>
<li><del><code>family-engagement</code></del> (Parts 3 &amp; 4)</li>
<li><del><code>family-engagement-transparency</code></del> (Part 5)  </li>
<li><del><code>family-engagement-transparency-comms</code></del> (Part 6)</li>
</ul>
<p><strong>Benefits of Consolidation:</strong></p>
<ul>
<li>‚úÖ <strong>One cohesive vertical</strong> instead of three fragmented ones</li>
<li>‚úÖ <strong>Correct database API</strong> - Uses raw SQL (<code>database.query()</code>) throughout</li>
<li>‚úÖ <strong>No duplicate tables</strong> - Single migration with 9 tables</li>
<li>‚úÖ <strong>Single source of truth</strong> - Clear responsibility boundaries</li>
<li>‚úÖ <strong>Easier maintenance</strong> - One codebase to test and deploy</li>
<li>‚úÖ <strong>Better integration</strong> - Unified service layer and API</li>
</ul>
<hr>
<h2>Overview</h2>
<p>The <strong>Family Engagement Platform</strong> vertical enables transparent, real-time communication between care providers and family members. It provides family members with secure portal access to view care updates, receive notifications, track progress, and communicate with the care team.</p>
<p>This vertical focuses on building trust and partnership with families through proactive transparency and open communication channels.</p>
<h2>Key Features</h2>
<h3>üîê Secure Portal Access</h3>
<ul>
<li><strong>Role-based access control</strong> - Granular permissions based on relationship and authorization</li>
<li><strong>Invitation system</strong> - Secure onboarding with email/SMS invitations</li>
<li><strong>Multi-level access</strong> - Basic, detailed, medical, financial, and full access levels</li>
<li><strong>Consent management</strong> - HIPAA-compliant authorization tracking</li>
<li><strong>Access expiration</strong> - Time-limited access for temporary guardians or advocates</li>
</ul>
<h3>üì¨ Notifications &amp; Alerts</h3>
<ul>
<li><strong>Multi-channel delivery</strong> - Email, SMS, and push notifications</li>
<li><strong>Priority levels</strong> - Low, normal, high, and urgent notifications</li>
<li><strong>Category-based</strong> - Visit updates, care plan changes, incidents, appointments, messages</li>
<li><strong>User preferences</strong> - Customizable notification settings per family member</li>
<li><strong>Quiet hours</strong> - Respect family members&#39; preferred communication times</li>
<li><strong>Digest options</strong> - Immediate, daily, or weekly notification summaries</li>
</ul>
<h3>üì∞ Activity Feed</h3>
<ul>
<li><strong>Real-time updates</strong> - See care activities as they happen</li>
<li><strong>Event tracking</strong> - Visits, tasks, goals, incidents, and more</li>
<li><strong>Rich metadata</strong> - Who performed the action, when, and context</li>
<li><strong>Read status</strong> - Track which updates have been viewed</li>
<li><strong>Filtering</strong> - Filter by activity type, date range, or caregiver</li>
</ul>
<h3>üí¨ Messaging System</h3>
<ul>
<li><strong>Threaded conversations</strong> - Organized discussions with care team</li>
<li><strong>File attachments</strong> - Share photos, documents, and reports</li>
<li><strong>Staff assignment</strong> - Route conversations to appropriate coordinators</li>
<li><strong>Read receipts</strong> - Know when messages have been viewed</li>
<li><strong>Internal notes</strong> - Staff-only comments not visible to family</li>
<li><strong>Priority flagging</strong> - Mark important conversations</li>
</ul>
<h3>üìä Transparency Reports</h3>
<ul>
<li><strong>Visit summaries</strong> - Family-friendly reports of completed visits</li>
<li><strong>Task completion</strong> - See which care tasks were performed</li>
<li><strong>Progress reports</strong> - Weekly/monthly care plan progress updates</li>
<li><strong>Goal tracking</strong> - Visual progress toward care goals</li>
<li><strong>Incident notifications</strong> - Immediate alerts for important events</li>
</ul>
<h3>üë• Family Member Management</h3>
<ul>
<li><strong>Multiple family members</strong> - Support for multiple authorized contacts</li>
<li><strong>Relationship tracking</strong> - Spouse, child, guardian, healthcare proxy, etc.</li>
<li><strong>Primary contact</strong> - Designate main point of contact</li>
<li><strong>Contact preferences</strong> - Email, phone, SMS, or portal</li>
<li><strong>Access audit</strong> - Track who accessed what information and when</li>
</ul>
<h2>Architecture</h2>
<h3>Data Model</h3>
<pre><code class="language-typescript">// Core entities
- FamilyMember         // Portal user with relationship to client
- PortalInvitation     // Secure invitation for portal access
- Notification         // Alert sent to family member
- ActivityFeedItem     // Care event in family timeline
- MessageThread        // Conversation between family and staff
- Message              // Individual message in thread
- VisitSummary         // Family-friendly visit report
- CarePlanProgressReport // Periodic progress summary
- FamilyConsent        // Authorization and consent records
</code></pre>
<h3>Key Relationships</h3>
<pre><code>Client
  ‚îî‚îÄ‚îÄ FamilyMember (1:many)
       ‚îú‚îÄ‚îÄ Notifications (1:many)
       ‚îú‚îÄ‚îÄ ActivityFeedItems (1:many)
       ‚îú‚îÄ‚îÄ MessageThreads (1:many)
       ‚îú‚îÄ‚îÄ VisitSummaries (many:many)
       ‚îî‚îÄ‚îÄ Consents (1:many)

MessageThread
  ‚îî‚îÄ‚îÄ Messages (1:many)

Visit
  ‚îî‚îÄ‚îÄ VisitSummary (1:1)

CarePlan
  ‚îî‚îÄ‚îÄ CarePlanProgressReport (1:many)
</code></pre>
<h2>Getting Started</h2>
<h3>Installation</h3>
<p>The family engagement vertical is part of the Care Commons monorepo:</p>
<pre><code class="language-bash"># Install dependencies
npm install

# Build the vertical
cd verticals/family-engagement
npm run build

# Run tests
npm test
</code></pre>
<h3>Database Migration</h3>
<p>Run the migration to create family engagement tables:</p>
<pre><code class="language-bash"># From project root
npm run db:migrate

# The migration creates:
# - family_members
# - portal_invitations
# - family_notifications
# - family_activity_feed
# - message_threads
# - messages
# - family_visit_summaries
# - care_plan_progress_reports
# - family_consent
</code></pre>
<h3>Service Setup</h3>
<pre><code class="language-typescript">import { Database, PermissionService } from &#39;@care-commons/core&#39;;
import {
  FamilyMemberRepository,
  NotificationRepository,
  ActivityFeedRepository,
  MessageRepository,
  FamilyEngagementService
} from &#39;@care-commons/family-engagement&#39;;

// Initialize repositories
const familyMemberRepo = new FamilyMemberRepository(database);
const notificationRepo = new NotificationRepository(database);
const activityFeedRepo = new ActivityFeedRepository(database);
const messageRepo = new MessageRepository(database);

// Initialize service
const familyEngagementService = new FamilyEngagementService(
  familyMemberRepo,
  notificationRepo,
  activityFeedRepo,
  messageRepo,
  permissionService
);
</code></pre>
<h3>API Routes</h3>
<pre><code class="language-typescript">import { Router } from &#39;express&#39;;
import { createFamilyEngagementHandlers } from &#39;@care-commons/family-engagement&#39;;

const router = Router();
const handlers = createFamilyEngagementHandlers(familyEngagementService);

// Family member management
router.post(&#39;/family-members/invite&#39;, handlers.inviteFamilyMember);
router.get(&#39;/family-members/:id&#39;, handlers.getFamilyMemberProfile);
router.get(&#39;/family-members/client/:clientId&#39;, handlers.getFamilyMembersForClient);
router.patch(&#39;/family-members/:id/portal-access&#39;, handlers.updatePortalAccess);

// Notifications
router.post(&#39;/notifications&#39;, handlers.sendNotification);
router.post(&#39;/notifications/broadcast&#39;, handlers.broadcastNotification);
router.get(&#39;/notifications/family-member/:familyMemberId/unread&#39;,
  handlers.getUnreadNotifications);
router.patch(&#39;/notifications/:id/read&#39;, handlers.markNotificationAsRead);

// Activity feed
router.get(&#39;/activity-feed/family-member/:familyMemberId&#39;,
  handlers.getRecentActivity);
router.post(&#39;/activity-feed&#39;, handlers.createActivityFeedItem);

// Messaging
router.post(&#39;/messages/threads&#39;, handlers.createMessageThread);
router.post(&#39;/messages/threads/:threadId/messages&#39;, handlers.sendMessage);
router.get(&#39;/messages/family-member/:familyMemberId/threads&#39;,
  handlers.getThreadsForFamilyMember);
router.get(&#39;/messages/threads/:threadId/messages&#39;,
  handlers.getMessagesInThread);

// Dashboard
router.get(&#39;/dashboard/family-member/:familyMemberId&#39;,
  handlers.getFamilyDashboard);

// Care events
router.post(&#39;/events/notify&#39;, handlers.notifyFamilyOfCareEvent);
</code></pre>
<h2>Usage Examples</h2>
<h3>1. Invite Family Member to Portal</h3>
<pre><code class="language-typescript">const familyMember = await familyEngagementService.inviteFamilyMember(
  {
    clientId: &#39;client-123&#39;,
    relationship: &#39;CHILD&#39;,
    relationshipNote: &#39;Primary caregiver for mother&#39;,
    isPrimaryContact: true,
    firstName: &#39;John&#39;,
    lastName: &#39;Doe&#39;,
    email: &#39;john.doe@example.com&#39;,
    phoneNumber: &#39;+1-555-0123&#39;,
    portalAccessLevel: &#39;VIEW_DETAILED&#39;,
    accessExpiresAt: null, // No expiration
    notificationPreferences: {
      emailEnabled: true,
      smsEnabled: true,
      pushEnabled: false,
      visitReminders: true,
      visitCompletedUpdates: true,
      careplanUpdates: true,
      incidentAlerts: true,
      appointmentReminders: true,
      messageNotifications: true,
      digestFrequency: &#39;IMMEDIATE&#39;
    }
  },
  userContext
);
</code></pre>
<h3>2. Send Notification After Visit Completion</h3>
<pre><code class="language-typescript">// Automatically notify family when visit is completed
await familyEngagementService.notifyFamilyOfCareEvent(
  clientId,
  &#39;VISIT_COMPLETED&#39;,
  {
    title: &#39;Visit Completed&#39;,
    message: &#39;Sarah Smith completed a 2-hour visit with your mother. All scheduled tasks were completed successfully.&#39;,
    relatedEntityType: &#39;VISIT&#39;,
    relatedEntityId: visitId,
    performedBy: caregiverId,
    performedByName: &#39;Sarah Smith&#39;
  },
  userContext
);
</code></pre>
<h3>3. Create Message Thread</h3>
<pre><code class="language-typescript">const thread = await familyEngagementService.createMessageThread(
  {
    familyMemberId: &#39;family-member-123&#39;,
    clientId: &#39;client-123&#39;,
    subject: &#39;Question about medication schedule&#39;,
    initialMessage: &#39;I noticed the medication times have changed. Can you explain the new schedule?&#39;,
    priority: &#39;NORMAL&#39;,
    assignedToUserId: coordinatorId
  },
  userContext
);
</code></pre>
<h3>4. Broadcast Important Update</h3>
<pre><code class="language-typescript">// Send notification to all family members
await familyEngagementService.broadcastNotification(
  clientId,
  {
    category: &#39;CARE_PLAN&#39;,
    priority: &#39;HIGH&#39;,
    title: &#39;Care Plan Updated&#39;,
    message: &#39;The care plan has been updated with new physical therapy goals. Please review the changes in your portal.&#39;,
    actionUrl: &#39;/portal/care-plans/123&#39;,
    actionLabel: &#39;View Care Plan&#39;
  },
  userContext
);
</code></pre>
<h3>5. Get Family Dashboard</h3>
<pre><code class="language-typescript">const dashboard = await familyEngagementService.getFamilyDashboard(
  familyMemberId,
  userContext
);

// Returns:
// {
//   client: { id, name, photoUrl },
//   upcomingVisits: [...],
//   recentActivity: [...],
//   unreadNotifications: 3,
//   unreadMessages: 1,
//   activeCarePlan: { id, name, goalsTotal, goalsAchieved }
// }
</code></pre>
<h2>Access Levels</h2>
<h3>VIEW_BASIC</h3>
<ul>
<li>View client profile (name, photo)</li>
<li>View upcoming visit schedule</li>
<li>Receive basic notifications</li>
<li>View activity feed (high-level)</li>
</ul>
<h3>VIEW_DETAILED</h3>
<ul>
<li>All of VIEW_BASIC, plus:</li>
<li>View care plan goals and interventions</li>
<li>View task completion details</li>
<li>View progress notes (family-appropriate)</li>
<li>Full activity feed access</li>
</ul>
<h3>VIEW_MEDICAL</h3>
<ul>
<li>All of VIEW_DETAILED, plus:</li>
<li>View medical diagnoses</li>
<li>View medications and vitals</li>
<li>View physician information</li>
<li>View incident reports</li>
</ul>
<h3>VIEW_FINANCIAL</h3>
<ul>
<li>View billing statements</li>
<li>View payment history</li>
<li>View insurance information</li>
<li>View authorization details</li>
</ul>
<h3>FULL_ACCESS</h3>
<ul>
<li>All permissions above</li>
<li>Can update contact information</li>
<li>Can grant access to additional family members (with approval)</li>
</ul>
<h2>Notification Categories</h2>
<table>
<thead>
<tr>
<th>Category</th>
<th>Description</th>
<th>Default Priority</th>
</tr>
</thead>
<tbody><tr>
<td>VISIT</td>
<td>Visit scheduled, started, completed, cancelled</td>
<td>NORMAL</td>
</tr>
<tr>
<td>CARE_PLAN</td>
<td>Care plan created, updated, goals achieved</td>
<td>NORMAL</td>
</tr>
<tr>
<td>INCIDENT</td>
<td>Incidents, falls, concerns</td>
<td>HIGH</td>
</tr>
<tr>
<td>APPOINTMENT</td>
<td>Medical appointments, assessments</td>
<td>NORMAL</td>
</tr>
<tr>
<td>MESSAGE</td>
<td>New messages from care team</td>
<td>NORMAL</td>
</tr>
<tr>
<td>REMINDER</td>
<td>Upcoming visits, medication reminders</td>
<td>LOW</td>
</tr>
<tr>
<td>SYSTEM</td>
<td>Account updates, access changes</td>
<td>NORMAL</td>
</tr>
</tbody></table>
<h2>Integration with Other Verticals</h2>
<h3>Scheduling &amp; Visits</h3>
<pre><code class="language-typescript">// After visit completion, create family notification
await familyEngagementService.notifyFamilyOfCareEvent(
  clientId,
  &#39;VISIT_COMPLETED&#39;,
  visitSummaryData,
  userContext
);
</code></pre>
<h3>Care Plans &amp; Tasks</h3>
<pre><code class="language-typescript">// When goal is achieved
await familyEngagementService.notifyFamilyOfCareEvent(
  clientId,
  &#39;GOAL_ACHIEVED&#39;,
  {
    title: &#39;Care Goal Achieved!&#39;,
    message: &#39;Your mother has successfully achieved her mobility goal.&#39;,
    relatedEntityType: &#39;GOAL&#39;,
    relatedEntityId: goalId
  },
  userContext
);
</code></pre>
<h3>Incident Reporting</h3>
<pre><code class="language-typescript">// Immediate notification for incidents
await familyEngagementService.sendNotification(
  {
    familyMemberId,
    clientId,
    category: &#39;INCIDENT&#39;,
    priority: &#39;URGENT&#39;,
    title: &#39;Incident Report&#39;,
    message: &#39;An incident has been reported. Please contact the care coordinator.&#39;,
    relatedEntityType: &#39;INCIDENT&#39;,
    relatedEntityId: incidentId
  },
  userContext
);
</code></pre>
<h2>Security &amp; Privacy</h2>
<h3>HIPAA Compliance</h3>
<ul>
<li><strong>Consent tracking</strong> - All information sharing requires documented consent</li>
<li><strong>Access audit logs</strong> - Track all family member access to PHI</li>
<li><strong>Minimum necessary</strong> - Access levels enforce minimum necessary access</li>
<li><strong>Secure communications</strong> - All messages and notifications encrypted in transit</li>
</ul>
<h3>Authentication</h3>
<ul>
<li><strong>Portal invitations</strong> - Secure, time-limited invitation codes</li>
<li><strong>Password requirements</strong> - Strong password policies</li>
<li><strong>Session management</strong> - Automatic logout after inactivity</li>
<li><strong>2FA support</strong> - Optional two-factor authentication</li>
</ul>
<h3>Authorization</h3>
<ul>
<li><strong>Relationship verification</strong> - Verify family relationships before granting access</li>
<li><strong>Client consent</strong> - Client (or guardian) must approve family portal access</li>
<li><strong>Revocable access</strong> - Access can be revoked at any time</li>
<li><strong>Expiring access</strong> - Support for time-limited access (e.g., temporary guardians)</li>
</ul>
<h2>Permissions</h2>
<p>Required permissions for family engagement operations:</p>
<table>
<thead>
<tr>
<th>Operation</th>
<th>Permission</th>
<th>Roles</th>
</tr>
</thead>
<tbody><tr>
<td>Invite family member</td>
<td><code>family-portal:invite</code></td>
<td>ADMIN, COORDINATOR</td>
</tr>
<tr>
<td>View family profiles</td>
<td><code>family-portal:view</code></td>
<td>ADMIN, COORDINATOR, CAREGIVER</td>
</tr>
<tr>
<td>Manage portal access</td>
<td><code>family-portal:manage</code></td>
<td>ADMIN, COORDINATOR</td>
</tr>
<tr>
<td>Send notifications</td>
<td><code>notifications:send</code></td>
<td>ADMIN, COORDINATOR, CAREGIVER</td>
</tr>
<tr>
<td>Broadcast notifications</td>
<td><code>notifications:broadcast</code></td>
<td>ADMIN, COORDINATOR</td>
</tr>
<tr>
<td>View notifications</td>
<td><code>notifications:view</code></td>
<td>ALL</td>
</tr>
<tr>
<td>View activity feed</td>
<td><code>activity-feed:view</code></td>
<td>ALL</td>
</tr>
<tr>
<td>Create messages</td>
<td><code>messages:create</code></td>
<td>ALL</td>
</tr>
<tr>
<td>Send messages</td>
<td><code>messages:send</code></td>
<td>ALL</td>
</tr>
<tr>
<td>View messages</td>
<td><code>messages:view</code></td>
<td>ALL</td>
</tr>
</tbody></table>
<h2>Best Practices</h2>
<h3>Family Onboarding</h3>
<ol>
<li><strong>Verify relationship</strong> - Confirm family member&#39;s relationship to client</li>
<li><strong>Obtain consent</strong> - Get signed consent from client or legal guardian</li>
<li><strong>Set appropriate access</strong> - Choose access level based on relationship and consent</li>
<li><strong>Send clear invitation</strong> - Provide helpful onboarding materials</li>
<li><strong>Follow up</strong> - Check that family member successfully activated portal</li>
</ol>
<h3>Communication</h3>
<ol>
<li><strong>Be proactive</strong> - Notify family of important events immediately</li>
<li><strong>Use appropriate tone</strong> - Keep messages family-friendly and empathetic</li>
<li><strong>Provide context</strong> - Include relevant details to avoid confusion</li>
<li><strong>Respond promptly</strong> - Reply to family messages within 24 hours</li>
<li><strong>Escalate when needed</strong> - Flag urgent concerns for immediate attention</li>
</ol>
<h3>Privacy</h3>
<ol>
<li><strong>Respect preferences</strong> - Honor notification and communication preferences</li>
<li><strong>Use access levels</strong> - Grant minimum necessary access</li>
<li><strong>Regular audits</strong> - Review family access periodically</li>
<li><strong>Secure messaging</strong> - Never include PHI in email or SMS notifications</li>
<li><strong>Document everything</strong> - Maintain audit trail of all access and communications</li>
</ol>
<h2>Development Status</h2>
<h3>‚úÖ Completed (Part 4)</h3>
<ul>
<li><input checked="" disabled="" type="checkbox"> TypeScript type definitions</li>
<li><input checked="" disabled="" type="checkbox"> Database schema and migrations</li>
<li><input checked="" disabled="" type="checkbox"> Repository layer (data access)</li>
<li><input checked="" disabled="" type="checkbox"> Service layer (business logic)</li>
<li><input checked="" disabled="" type="checkbox"> API handlers and routes</li>
<li><input checked="" disabled="" type="checkbox"> Notification system foundation</li>
<li><input checked="" disabled="" type="checkbox"> Activity feed system</li>
<li><input checked="" disabled="" type="checkbox"> Messaging system</li>
<li><input checked="" disabled="" type="checkbox"> Dashboard aggregation</li>
</ul>
<h3>üöß In Progress</h3>
<ul>
<li><input disabled="" type="checkbox"> Frontend React components</li>
<li><input disabled="" type="checkbox"> Portal registration flow</li>
<li><input disabled="" type="checkbox"> Email/SMS notification delivery</li>
<li><input disabled="" type="checkbox"> Push notification service</li>
<li><input disabled="" type="checkbox"> File attachment handling</li>
</ul>
<h3>üìã Planned</h3>
<ul>
<li><input disabled="" type="checkbox"> Mobile app support</li>
<li><input disabled="" type="checkbox"> Video calling integration</li>
<li><input disabled="" type="checkbox"> Photo/video sharing</li>
<li><input disabled="" type="checkbox"> Calendar integration</li>
<li><input disabled="" type="checkbox"> Appointment scheduling</li>
<li><input disabled="" type="checkbox"> Survey/feedback system</li>
<li><input disabled="" type="checkbox"> Multi-language support</li>
<li><input disabled="" type="checkbox"> Accessibility (WCAG 2.1 AA)</li>
</ul>
<h2>Testing</h2>
<pre><code class="language-bash"># Run unit tests
npm test

# Run with coverage
npm run test:coverage

# Run specific test file
npm test -- family-engagement-service.test.ts
</code></pre>
<h2>API Documentation</h2>
<p>For detailed API endpoint documentation, see:</p>
<ul>
<li><a href="./API_REFERENCE.md">API Reference</a> <em>(coming soon)</em></li>
<li><a href="./INTEGRATION_GUIDE.md">Integration Guide</a> <em>(coming soon)</em></li>
</ul>
<h2>Contributing</h2>
<p>When contributing to the family engagement vertical:</p>
<ol>
<li><strong>Maintain privacy</strong> - Always consider PHI and privacy implications</li>
<li><strong>Test thoroughly</strong> - Family features require extra care and testing</li>
<li><strong>Document changes</strong> - Update this README for any new features</li>
<li><strong>Follow patterns</strong> - Maintain consistency with other verticals</li>
<li><strong>Get feedback</strong> - Have changes reviewed by care coordinators</li>
</ol>
<h2>Support</h2>
<p>For questions or issues with the family engagement vertical:</p>
<ul>
<li><strong>GitHub Issues</strong>: <a href="https://github.com/neighborhood-lab/care-commons/issues">Report bugs or request features</a></li>
<li><strong>Discord</strong>: Join our community for support</li>
<li><strong>Documentation</strong>: Check the main Care Commons docs</li>
</ul>
<h2>License</h2>
<p>This vertical is part of Care Commons and is licensed under the same license. See <a href="../../LICENSE">LICENSE</a> for details.</p>
<hr>
<p><strong>Care Commons</strong> is brought to you by <a href="https://neighborhoodlab.org">Neighborhood Lab</a> üè°</p>
<p><em>Building trust through transparency and communication.</em></p>

      </article>
      <footer class="content-footer">
        <p>
          <strong>Care Commons</strong> - Shared care software, community owned<br>
          Brought to you by <a href="https://neighborhoodlab.org" target="_blank">Neighborhood Lab</a>
        </p>
      </footer>
    </main>
  </div>
</body>
</html>