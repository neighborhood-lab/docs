<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rollback Procedures - Care Commons Documentation</title>
  <meta name="description" content="Comprehensive documentation for Care Commons - Shared care software, community owned">
  <link rel="stylesheet" href="./styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      hljs.highlightAll();
      
      // Mobile menu toggle
      const menuToggle = document.querySelector('.menu-toggle');
      const sidebar = document.querySelector('.sidebar');
      if (menuToggle && sidebar) {
        menuToggle.addEventListener('click', () => {
          sidebar.classList.toggle('open');
        });
      }
      
      // Search functionality
      const searchInput = document.getElementById('search-input');
      const searchResults = document.getElementById('search-results');
      
      if (searchInput && searchResults) {
        searchInput.addEventListener('input', (e) => {
          const query = e.target.value.toLowerCase();
          if (query.length < 2) {
            searchResults.innerHTML = '';
            searchResults.style.display = 'none';
            return;
          }
          
          // Simple search through navigation items
          const navItems = document.querySelectorAll('.sidebar a');
          const matches = Array.from(navItems)
            .filter(item => item.textContent.toLowerCase().includes(query))
            .slice(0, 10);
          
          if (matches.length > 0) {
            searchResults.innerHTML = matches
              .map(item => `<a href="${item.href}" class="search-result">${item.textContent}</a>`)
              .join('');
            searchResults.style.display = 'block';
          } else {
            searchResults.innerHTML = '<div class="search-result no-results">No results found</div>';
            searchResults.style.display = 'block';
          }
        });
        
        // Hide results when clicking outside
        document.addEventListener('click', (e) => {
          if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
            searchResults.style.display = 'none';
          }
        });
      }
    });
  </script>
</head>
<body>
  <div class="container">
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1><a href="./index.html">Care Commons Docs</a></h1>
        <button class="menu-toggle" aria-label="Toggle menu">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
      <div class="search-container">
        <input type="text" id="search-input" placeholder="Search documentation..." />
        <div id="search-results"></div>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-category">
      <h3>üöÄ Getting Started</h3>
      <ul><li><a href="./api-readme.html">API Directory - Vercel Serverless Functions</a></li><li><a href="./claude-layer-2-input-readme.html">Layer 2 Implementation Tasks</a></li><li><a href="./claude-readme.html">Claude Autonomous Task Management System</a></li><li><a href="./database-quickstart.html">Database Quick Start</a></li><li><a href="./demo-quickstart.html">Rich Interactive Demo - Quick Start Guide</a></li><li><a href="./deployment-quick-start.html">Deployment Quick Start Guide</a></li><li><a href="./deployment-quickstart.html">Deployment Quick Start</a></li><li><a href="./docs-compliance-readme.html">State Compliance Documentation</a></li><li><a href="./e2e-readme.html">Care Commons: End-to-End Testing Guide</a></li><li><a href="./packages-mobile-quickstart-mobile.html">Mobile App Quick Start Guide</a></li><li><a href="./packages-mobile-quickstart.html">Mobile App Quickstart Guide</a></li><li><a href="./packages-web-quickstart.html">Quick Start Guide</a></li><li><a href="./readme.html">Care Commons</a></li><li><a href="./scripts-readme.html">Care Commons Deployment Scripts</a></li><li><a href="./showcase-quick-start.html">Showcase Quick Start Guide</a></li><li><a href="./showcase-readme.html">Care Commons Showcase</a></li><li><a href="./vercel-quickstart.html">Vercel Environment Setup - Quick Start</a></li><li><a href="./verticals-analytics-reporting-readme.html">Analytics & Reporting Vertical</a></li><li><a href="./verticals-billing-invoicing-readme.html">Billing & Invoicing</a></li><li><a href="./verticals-care-plans-tasks-quickstart.html">Care Plans & Tasks Library - Quickstart</a></li><li><a href="./verticals-care-plans-tasks-readme.html">Care Plans & Tasks Library</a></li><li><a href="./verticals-caregiver-staff-quickstart.html">Caregiver & Staff Management - Quick Start</a></li><li><a href="./verticals-caregiver-staff-readme.html">Caregiver & Staff Management</a></li><li><a href="./verticals-client-demographics-readme.html">Client & Demographics Management</a></li><li><a href="./verticals-family-engagement-readme.html">Family Engagement Platform (Consolidated)</a></li><li><a href="./verticals-payroll-processing-readme.html">Payroll Processing</a></li><li><a href="./verticals-quality-assurance-audits-readme.html">Quality Assurance & Audits Vertical</a></li><li><a href="./verticals-scheduling-visits-quickstart.html">Quickstart: Scheduling & Visit Management</a></li><li><a href="./verticals-scheduling-visits-readme.html">Scheduling & Visit Management</a></li><li><a href="./verticals-shift-matching-readme.html">Shift Matching & Assignment</a></li><li><a href="./verticals-time-tracking-evv-quickstart.html">Time Tracking & EVV - Quick Start Guide</a></li><li><a href="./verticals-time-tracking-evv-readme.html">Time Tracking & Electronic Visit Verification (EVV)</a></li></ul></div><div class="nav-category">
      <h3>üìñ User Guides</h3>
      <ul><li><a href="./claude-0002-fix-client-demographics-api-error.html">Task 0002: Fix Client Demographics API Type Error</a></li><li><a href="./docs-deployment-guide.html">Care Commons Deployment Guide</a></li><li><a href="./docs-performance-optimization-guide.html">Performance Optimization Guide</a></li><li><a href="./packages-web-src-showcase-readme.html">Care Commons Showcase Enhancements</a></li><li><a href="./rich-demo-implementation-plan.html">Rich Interactive Demo Implementation Plan</a></li><li><a href="./showcase-demo-data-implementation.html">Showcase Demo Data Implementation</a></li><li><a href="./showcase.html">Care Commons Platform - Interactive Showcase</a></li><li><a href="./showcase-part3-summary.html">Showcase Part 3: Multi-Role Experience Implementation</a></li><li><a href="./sync-integration-guide.html">Offline-First Sync Integration Guide</a></li><li><a href="./verticals-care-plans-tasks-demo.html">Care Plans & Tasks Library - Demo Guide</a></li><li><a href="./verticals-client-demographics-changelog.html">Changelog - Client & Demographics Management</a></li><li><a href="./verticals-client-demographics-examples.html">Client & Demographics - Usage Examples</a></li><li><a href="./verticals-client-demographics-migration.html">Migration Guide - Client & Demographics Management</a></li><li><a href="./verticals-scheduling-visits-wiring-guide.html">Scheduling Service Wiring Guide</a></li><li><a href="./verticals-shift-matching-demo.html">Shift Matching & Assignment Demo</a></li><li><a href="./verticals-time-tracking-evv-migration-guide.html">Migration Guide: TX/FL to Multi-State EVV</a></li><li><a href="./verticals-time-tracking-evv-multistate-guide.html">Multi-State EVV Integration Guide</a></li></ul></div><div class="nav-category">
      <h3>üèóÔ∏è Architecture & Deployment</h3>
      <ul><li><a href="./github-pull-request-template-mobile-pr-template.html">Mobile Pr Template</a></li><li><a href="./github-workflows-deployment-diagram.html">Deployment Flow Diagram</a></li><li><a href="./github-workflows-deployment-flow.html">Deployment Workflow Guide</a></li><li><a href="./autonomous-session-summary.html">Autonomous Development Session Summary</a></li><li><a href="./claude-layer-1-memory.html">Care Commons - Central Planner Vision & State</a></li><li><a href="./cloudflare-deployment.html">Cloudflare Deployment Guide</a></li><li><a href="./deployment-options.html">Deployment Options for Care Commons</a></li><li><a href="./deployment-quick-reference.html">Deployment Quick Reference</a></li><li><a href="./deployment-ready.html">‚úÖ Deployment Ready - Care Commons Platform</a></li><li><a href="./deployment.html">Cloud Deployment Guide</a></li><li><a href="./docs-compliance-index.html">State Compliance Documentation</a></li><li><a href="./docs-compliance-project-summary.html">State Compliance Documentation System - Project Summary</a></li><li><a href="./docs-deployment-setup-complete.html">Complete Deployment Setup Guide for Care Commons</a></li><li><a href="./docs-runbooks-manual-deployment.html">Manual Deployment Runbook</a></li><li><a href="./hardening-summary.html">Codebase Hardening Summary</a></li><li><a href="./implementation-complete-final.html">React Native Mobile Foundation - COMPLETE ‚úÖ</a></li><li><a href="./implementation-note.html">ML-Based Shift Matching Implementation</a></li><li><a href="./offline-first-architecture.html">Offline-First Architecture Implementation</a></li><li><a href="./offline-first-implementation-summary.html">Offline-First Architecture - Implementation Summary</a></li><li><a href="./packages-app-readme.html">Care Commons API Server</a></li><li><a href="./packages-core-src-compliance-readme.html">Multi-State Compliance System</a></li><li><a href="./packages-mobile-deployment-checklist.html">Mobile App Deployment Checklist</a></li><li><a href="./packages-mobile-implementation-summary.html">React Native Mobile Foundation - Implementation Summary</a></li><li><a href="./packages-mobile-mobile-foundation-summary.html">React Native Mobile Foundation - Implementation Summary</a></li><li><a href="./packages-shared-components-readme.html">@care-commons/shared-components</a></li><li><a href="./packages-web-architecture.html">Web Architecture</a></li><li><a href="./packages-web-readme.html">Care Commons Web UI</a></li><li><a href="./production-deployment.html">Production Deployment Guide - Vercel</a></li><li><a href="./pull-request-summary.html">Pull Request: Offline-First Synchronization System</a></li><li><a href="./tx-fl-implementation-summary.html">Texas and Florida State-Specific Implementation Summary</a></li><li><a href="./verticals-billing-invoicing-implementation-summary.html">Billing & Invoicing - Implementation Summary</a></li><li><a href="./verticals-care-plans-tasks-summary.html">Care Plans & Tasks Library - Implementation Summary</a></li><li><a href="./verticals-scheduling-visits-implementation.html">Implementation: Scheduling & Visit Management</a></li><li><a href="./verticals-scheduling-visits-summary.html">Scheduling & Visit Management - Implementation Summary</a></li><li><a href="./verticals-time-tracking-evv-changelog.html">Changelog</a></li><li><a href="./verticals-time-tracking-evv-evv-sync-integration.html">EVV Sync Integration Guide</a></li><li><a href="./verticals-time-tracking-evv-summary.html">Time Tracking & EVV Implementation Summary</a></li><li><a href="./web-implementation-summary.html">React Frontend Implementation Summary</a></li></ul></div><div class="nav-category">
      <h3>‚öôÔ∏è Implementation Details</h3>
      <ul><li><a href="./github-snyk-integration.html">Snyk Integration Policy</a></li><li><a href="./github-workflows-deployment-checklist.html">üöÄ Deployment Safety Checklist</a></li><li><a href="./agents.html">Agent Implementation Directives</a></li><li><a href="./api-cloudflare-workers-setup.html">Cloudflare Workers Setup (TODO)</a></li><li><a href="./auth-login-debugging.html">Authentication Login Failure Debugging Report</a></li><li><a href="./claude-0000-task-management-system-setup.html">Task 0000: Task Management System Setup</a></li><li><a href="./claude-0001-fix-caregiver-repository-type-errors.html">Task 0001: Fix Caregiver Repository Type Errors</a></li><li><a href="./claude-0003-create-state-compliance-service.html">Task 0003: Create State Compliance Service</a></li><li><a href="./claude-0004-implement-state-specific-evv-validation.html">Task 0004: Implement State-Specific EVV Validation</a></li><li><a href="./claude-0005-implement-visit-status-notifications.html">Task 0005: Implement Visit Status Notifications</a></li><li><a href="./claude-0006-build-clinical-documentation-foundation.html">Task 0006: Build Clinical Documentation Foundation</a></li><li><a href="./claude-0008-fix-evv-notification-recipients.html">Task 0008: Fix EVV Notification Recipients</a></li><li><a href="./claude-0009-integrate-family-engagement-with-services.html">Task 0009: Integrate Family Engagement with Client/Care Plan Services</a></li><li><a href="./claude-0010-implement-hhaexchange-evv-aggregator-integration.html">Task 0010: Implement HHAeXchange EVV Aggregator Integration</a></li><li><a href="./claude-0013-implement-holiday-filtering-in-schedule-service.html">Task 0013: Implement Holiday Filtering in Schedule Service</a></li><li><a href="./claude-0014-implement-mobile-push-notifications.html">Task 0014: Implement Mobile Push Notifications</a></li><li><a href="./claude-0015-implement-mobile-sync-status-screen.html">Task 0015: Implement Mobile Sync Status Screen</a></li><li><a href="./claude-0016-implement-mobile-e2e-testing.html">Task 0016: Implement Mobile E2E Testing for Critical Caregiver Workflows</a></li><li><a href="./claude-layer-1-input.html">Input</a></li><li><a href="./claude-layer-2-input-0003-mobile-offline-sync-status.html">Task 0003: Mobile Offline Sync Status Screen</a></li><li><a href="./claude-layer-2-input-0004-api-caregivers-me-endpoint.html">Task 0004: Caregiver Profile API Endpoint</a></li><li><a href="./claude-layer-2-input-0005-api-visits-my-visits-endpoint.html">Task 0005: My Visits API Endpoint</a></li><li><a href="./claude-layer-2-input-0006-mobile-visit-notes.html">Task 0006: Mobile Visit Notes Entry</a></li><li><a href="./claude-layer-2-input-0007-web-client-dashboard.html">Task 0007: Web Client Dashboard</a></li><li><a href="./claude-layer-2-input-0008-api-rate-limiting.html">Task 0008: API Rate Limiting Middleware</a></li><li><a href="./claude-layer-2-input-0009-error-monitoring-setup.html">Task 0009: Error Monitoring and Logging</a></li><li><a href="./claude-layer-2-input-0010-database-backup-strategy.html">Task 0010: Database Backup and Recovery</a></li><li><a href="./claude-layer-2-input-0011-mobile-biometric-auth.html">Task 0011: Mobile Biometric Authentication</a></li><li><a href="./claude-layer-2-input-0012-api-documentation.html">Task 0012: API Documentation with OpenAPI</a></li><li><a href="./claude-layer-2-input-0013-web-coordinator-onboarding.html">Task 0013: Coordinator Onboarding Flow</a></li><li><a href="./claude-layer-2-input-0014-mobile-push-notifications.html">Task 0014: Mobile Push Notifications</a></li><li><a href="./claude-layer-2-input-0015-testing-improvements.html">Task 0015: Test Coverage Improvements</a></li><li><a href="./claude-layer-2-instructions.html">INSTRUCTIONS</a></li><li><a href="./cli-tools-installed.html">‚úÖ CLI Tools Installed & Ready</a></li><li><a href="./contributing.html">Contributing to Care Commons</a></li><li><a href="./cors-fix.html">CORS Fix for Vercel Deployments</a></li><li><a href="./create-mobile-pr.html">Create Mobile Foundation PR</a></li><li><a href="./database-environments.html">Database Environment Management</a></li><li><a href="./dev-setup.html">Development Setup Guide</a></li><li><a href="./docs-api-documentation.html">API Documentation</a></li><li><a href="./docs-compliance-template-changelog.html">[STATE NAME] Regulatory Changelog</a></li><li><a href="./docs-compliance-template-implementation.html">[STATE NAME] Compliance Implementation Guide</a></li><li><a href="./docs-compliance-template-requirements.html">[STATE NAME] Home Healthcare Compliance Requirements</a></li><li><a href="./docs-compliance-template-test-scenarios.html">[STATE NAME] Compliance Test Scenarios</a></li><li><a href="./docs-compliance-florida-changelog.html">Florida Regulatory Changelog</a></li><li><a href="./docs-compliance-florida-requirements.html">Florida Home Healthcare Compliance Requirements</a></li><li><a href="./docs-compliance-ohio-changelog.html">Ohio Compliance Changelog</a></li><li><a href="./docs-compliance-ohio-implementation.html">Ohio Compliance Implementation Guide</a></li><li><a href="./docs-compliance-ohio-requirements.html">Ohio Home Healthcare Compliance Requirements</a></li><li><a href="./docs-compliance-ohio-test-scenarios.html">Ohio Compliance Test Scenarios</a></li><li class="more-docs">+ 59 more documents</li></ul></div>
      </nav>
    </aside>
    <main class="content">
      <div class="breadcrumbs">
      <a href="./index.html">Home</a> / 
      <span>‚öôÔ∏è Implementation Details</span> / 
      <span>Rollback Procedures</span>
    </div>
      <article class="markdown-content">
        <h1>Rollback Procedures</h1>
<p><strong>Version</strong>: 1.0
<strong>Last Updated</strong>: 2025-11-08
<strong>Owner</strong>: Engineering Team</p>
<hr>
<h2>Table of Contents</h2>
<ol>
<li><a href="#overview">Overview</a></li>
<li><a href="#when-to-rollback">When to Rollback</a></li>
<li><a href="#rollback-methods">Rollback Methods</a></li>
<li><a href="#emergency-rollback-procedure">Emergency Rollback Procedure</a></li>
<li><a href="#database-rollback">Database Rollback</a></li>
<li><a href="#post-rollback-actions">Post-Rollback Actions</a></li>
<li><a href="#testing-rollback-procedures">Testing Rollback Procedures</a></li>
</ol>
<hr>
<h2>Overview</h2>
<p>This document outlines the procedures for rolling back a production deployment when critical issues are detected. Rollbacks should be executed quickly but carefully to minimize service disruption and prevent data loss.</p>
<p><strong>Key Principles</strong>:</p>
<ul>
<li><strong>Speed</strong>: Rollbacks should complete within 5-10 minutes</li>
<li><strong>Safety</strong>: Never rollback database migrations without careful consideration</li>
<li><strong>Communication</strong>: Always notify team and stakeholders</li>
<li><strong>Documentation</strong>: Document the issue and rollback decision</li>
</ul>
<hr>
<h2>When to Rollback</h2>
<h3>Automatic Rollback Triggers</h3>
<p>The system will automatically rollback in these scenarios:</p>
<ol>
<li><strong>Health Check Failure</strong>: <code>/health</code> endpoint returns non-200 status after deployment</li>
<li><strong>Build Failure</strong>: Application build fails during deployment</li>
<li><strong>Critical Error Rate</strong>: Error rate &gt; 10% within first 5 minutes</li>
</ol>
<h3>Manual Rollback Decision Criteria</h3>
<h4>CRITICAL - Immediate Rollback (&lt; 5 minutes)</h4>
<p><strong>Security Incidents</strong>:</p>
<ul>
<li>Authentication bypass discovered</li>
<li>Unauthorized data access detected</li>
<li>SQL injection vulnerability found</li>
<li>Credentials leaked</li>
<li>HIPAA compliance breach</li>
</ul>
<p><strong>Data Integrity</strong>:</p>
<ul>
<li>Data corruption detected</li>
<li>Data deletion bug causing data loss</li>
<li>Database migration caused data loss</li>
<li>Sync bugs causing conflicting data</li>
</ul>
<p><strong>Complete Service Outage</strong>:</p>
<ul>
<li>Application crashes on startup (all instances)</li>
<li>Database connectivity completely lost</li>
<li>All API requests returning 500 errors</li>
<li>Unable to authenticate any users</li>
</ul>
<h4>HIGH Priority - Rollback Within 15 Minutes</h4>
<p><strong>High Error Rate</strong>:</p>
<ul>
<li>Error rate &gt; 5% sustained for 10+ minutes</li>
<li>Critical user flows completely broken:<ul>
<li>Cannot log in</li>
<li>Cannot create visits</li>
<li>Cannot clock in/out</li>
<li>Mobile sync completely failing</li>
</ul>
</li>
</ul>
<p><strong>Severe Performance</strong>:</p>
<ul>
<li>Response time p95 &gt; 5 seconds sustained</li>
<li>Database queries timing out</li>
<li>Connection pool completely exhausted</li>
<li>Application becomes unusable</li>
</ul>
<p><strong>Compliance</strong>:</p>
<ul>
<li>EVV data not being captured correctly</li>
<li>Audit logging completely failing</li>
<li>Required PHI encryption not working</li>
</ul>
<h4>MEDIUM Priority - Investigate First (30-60 minutes)</h4>
<p><strong>Moderate Issues</strong>:</p>
<ul>
<li>Error rate 1-5% sustained</li>
<li>Non-critical features broken</li>
<li>Performance degradation (p95 &gt; 1 second)</li>
<li>User reports of specific bugs</li>
</ul>
<p><strong>Decision Process</strong>:</p>
<ol>
<li>Assess impact (how many users affected?)</li>
<li>Check if hotfix is possible (&lt; 30 minutes)</li>
<li>If hotfix not feasible ‚Üí rollback</li>
<li>If impact is low ‚Üí monitor and plan hotfix</li>
</ol>
<hr>
<h2>Rollback Methods</h2>
<h3>Method 1: Vercel Instant Rollback (Recommended)</h3>
<p><strong>Best for</strong>: Application code issues (no database changes)</p>
<p><strong>Advantages</strong>:</p>
<ul>
<li>Fastest method (&lt; 2 minutes)</li>
<li>No code changes required</li>
<li>One-click rollback in dashboard</li>
</ul>
<p><strong>Limitations</strong>:</p>
<ul>
<li>Does not rollback database migrations</li>
<li>Must handle database migration rollback separately</li>
</ul>
<p><strong>Procedure</strong>:</p>
<ol>
<li><p><strong>Via Vercel Dashboard</strong>:</p>
<pre><code>1. Go to https://vercel.com/[your-org]/[your-project]
2. Click &quot;Deployments&quot; tab
3. Find the last known good deployment
4. Click &quot;...&quot; menu ‚Üí &quot;Promote to Production&quot;
5. Confirm the rollback
</code></pre>
</li>
<li><p><strong>Via Vercel CLI</strong>:</p>
<pre><code class="language-bash"># List recent deployments
vercel list

# Promote previous deployment to production
vercel promote [deployment-url]
</code></pre>
</li>
</ol>
<p><strong>Expected Duration</strong>: 1-2 minutes</p>
<h3>Method 2: GitHub Actions Rollback Workflow</h3>
<p><strong>Best for</strong>: Structured rollback with team notification</p>
<p><strong>Procedure</strong>:</p>
<ol>
<li><p><strong>Trigger Rollback Workflow</strong>:</p>
<pre><code>1. Go to GitHub ‚Üí Actions ‚Üí &quot;Rollback Production&quot;
2. Click &quot;Run workflow&quot;
3. Select branch: main
4. Input: Previous deployment SHA or tag
5. Click &quot;Run workflow&quot;
</code></pre>
</li>
<li><p><strong>Automated Steps</strong>:</p>
<ul>
<li>Checks out previous commit</li>
<li>Runs tests</li>
<li>Deploys to Vercel</li>
<li>Runs health checks</li>
<li>Posts notification to Slack</li>
</ul>
</li>
</ol>
<p><strong>Expected Duration</strong>: 5-10 minutes</p>
<h3>Method 3: Git Revert and Redeploy</h3>
<p><strong>Best for</strong>: When specific commits need to be reverted</p>
<p><strong>Procedure</strong>:</p>
<pre><code class="language-bash"># 1. Identify the problematic commit
git log --oneline -10

# 2. Create revert commit
git revert [bad-commit-sha]

# Or revert multiple commits
git revert [sha-1] [sha-2] [sha-3]

# 3. Push to main (triggers automatic deployment)
git push origin main

# 4. Monitor deployment
# GitHub Actions will automatically deploy the revert
</code></pre>
<p><strong>Expected Duration</strong>: 10-15 minutes</p>
<h3>Method 4: Emergency Hotfix</h3>
<p><strong>Best for</strong>: Simple bugs with obvious fixes</p>
<p><strong>When to use</strong>:</p>
<ul>
<li>Bug has clear, simple fix (&lt; 10 lines of code)</li>
<li>Fix can be implemented in &lt; 15 minutes</li>
<li>Error rate is moderate (1-5%), not critical</li>
</ul>
<p><strong>Procedure</strong>:</p>
<pre><code class="language-bash"># 1. Create hotfix branch
git checkout -b hotfix/critical-bug-fix

# 2. Make minimal fix

# 3. Test locally
npm run lint
npm run type-check
npm test

# 4. Push and create PR
git push origin hotfix/critical-bug-fix

# 5. Get fast-track approval (1 reviewer minimum)

# 6. Merge to main (triggers deployment)

# 7. Monitor closely
</code></pre>
<p><strong>Expected Duration</strong>: 20-30 minutes</p>
<hr>
<h2>Emergency Rollback Procedure</h2>
<p><strong>Use this for CRITICAL issues requiring immediate action</strong></p>
<h3>Step 1: Alert the Team (0-2 minutes)</h3>
<pre><code>1. Post in #incidents Slack channel:
   &quot;@here CRITICAL: Rolling back production deployment
   Reason: [brief description]
   Triggered by: [your name]
   Method: [Vercel instant rollback / GitHub Actions / etc]&quot;

2. Start incident call (if available):
   - Google Meet / Zoom link in Slack channel
</code></pre>
<h3>Step 2: Execute Rollback (2-5 minutes)</h3>
<p><strong>Fastest Method - Vercel Dashboard</strong>:</p>
<pre><code>1. Open: https://vercel.com/[your-org]/[your-project]/deployments

2. Identify last known good deployment:
   - Look for most recent deployment before current
   - Verify it has &quot;Ready&quot; status
   - Check timestamp matches pre-issue deployment

3. Click &quot;...&quot; menu next to that deployment

4. Select &quot;Promote to Production&quot;

5. Confirm: &quot;Yes, promote to production&quot;

6. Wait for promotion to complete (~60 seconds)
</code></pre>
<h3>Step 3: Verify Rollback (5-7 minutes)</h3>
<pre><code class="language-bash"># 1. Check health endpoint
curl https://[your-domain]/health

# Expected: {&quot;status&quot;: &quot;healthy&quot;, ...}

# 2. Check Sentry for new errors
# Open: https://sentry.io/organizations/[your-org]/issues

# 3. Test critical flows manually:
# - User login
# - Create test visit
# - Mobile sync

# 4. Check metrics
curl -H &quot;Authorization: Bearer $TOKEN&quot; https://[domain]/metrics

# Verify error rate dropping
</code></pre>
<h3>Step 4: Communicate Status (7-10 minutes)</h3>
<pre><code>1. Update #incidents channel:
   &quot;Rollback complete. Services restored to [previous version].
   Health checks: ‚úÖ Passing
   Error rate: [current rate]
   Investigating root cause.&quot;

2. If user-facing impact, post status update:
   - Internal status page
   - Customer communication (if applicable)
</code></pre>
<h3>Step 5: Root Cause Analysis (Post-Rollback)</h3>
<pre><code>1. Preserve evidence:
   - Save Sentry errors
   - Export logs from failed deployment
   - Screenshot metrics/dashboards

2. Schedule post-mortem:
   - Within 24 hours
   - All relevant team members
   - Blameless retrospective

3. Create follow-up tasks:
   - Fix root cause
   - Add tests to prevent recurrence
   - Update deployment procedures if needed
</code></pre>
<hr>
<h2>Database Rollback</h2>
<p><strong>‚ö†Ô∏è WARNING</strong>: Database rollbacks are risky and can cause data loss. Only perform if absolutely necessary.</p>
<h3>When to Rollback Database Migrations</h3>
<p><strong>Only in these scenarios</strong>:</p>
<ol>
<li>Migration caused data corruption</li>
<li>Migration caused complete data loss</li>
<li>Migration broke critical functionality and hotfix impossible</li>
<li>Migration exposed security vulnerability</li>
</ol>
<p><strong>Do NOT rollback for</strong>:</p>
<ul>
<li>Application code issues (rollback app only)</li>
<li>Performance issues (investigate first)</li>
<li>Minor bugs (hotfix instead)</li>
</ul>
<h3>Database Rollback Procedure</h3>
<h4>Step 1: Assessment (Critical)</h4>
<pre><code>BEFORE rolling back database, answer:

1. Will rollback cause data loss?
   - Were new columns added with user data?
   - Were records created that depend on new schema?

2. Is there an alternative?
   - Can we add a hotfix migration instead?
   - Can we rollback app code only?

3. What is the rollback scope?
   - How many migrations to rollback?
   - What is the data impact?

Only proceed if rollback is absolutely necessary and data loss is acceptable.
</code></pre>
<h4>Step 2: Database Backup (CRITICAL)</h4>
<pre><code class="language-bash"># ALWAYS take backup before rollback

# Connect to Neon dashboard
# 1. Go to https://console.neon.tech
# 2. Select your project
# 3. Go to &quot;Branches&quot; tab
# 4. Create new branch from main: &quot;backup-before-rollback-[timestamp]&quot;
# 5. Wait for branch creation (creates point-in-time snapshot)

# Alternative: Manual backup
# Export database to SQL file
pg_dump $DATABASE_URL &gt; backup-$(date +%Y%m%d-%H%M%S).sql

# Upload backup to secure location
# aws s3 cp backup-*.sql s3://[backup-bucket]/emergency-backups/
</code></pre>
<h4>Step 3: Execute Migration Rollback</h4>
<pre><code class="language-bash"># Check current migration status
npm run db:migrate:status

# Rollback ONE migration at a time
npm run db:migrate:rollback

# Verify migration rolled back successfully
npm run db:migrate:status

# If multiple migrations need rollback, repeat:
npm run db:migrate:rollback

# After each rollback, verify:
# 1. Application still functions
# 2. No data loss
# 3. No error spikes
</code></pre>
<h4>Step 4: Verify Application Compatibility</h4>
<pre><code class="language-bash"># After database rollback, verify app works with old schema

# 1. Run health check
curl https://[domain]/health

# 2. Test database queries
# Check logs for database errors

# 3. If current application incompatible with rolled-back schema:
# ‚Üí Must also rollback application code (see Method 1 above)
</code></pre>
<h4>Step 5: Data Verification</h4>
<pre><code class="language-sql">-- Connect to database
psql $DATABASE_URL

-- Check critical tables
SELECT COUNT(*) FROM users;
SELECT COUNT(*) FROM visits;
SELECT COUNT(*) FROM clients;
SELECT COUNT(*) FROM caregivers;

-- Compare with expected counts
-- Verify no unexpected data loss
</code></pre>
<h3>Database Rollback Alternatives</h3>
<p><strong>Instead of rollback, consider</strong>:</p>
<ol>
<li><p><strong>Forward Migration</strong> (Preferred):</p>
<pre><code class="language-bash"># Create new migration to fix issue
npm run db:migration:make fix_previous_migration

# Edit migration file to fix the problem
# Then deploy
</code></pre>
</li>
<li><p><strong>Hotfix Migration</strong>:</p>
<pre><code class="language-bash"># Add migration that undoes problematic changes
# Without rolling back
</code></pre>
</li>
<li><p><strong>Feature Flag</strong>:</p>
<pre><code class="language-javascript">// Disable feature using environment variable
if (process.env.ENABLE_NEW_FEATURE !== &#39;true&#39;) {
  // Use old code path
}
</code></pre>
</li>
</ol>
<hr>
<h2>Post-Rollback Actions</h2>
<h3>Immediate Actions (Within 1 Hour)</h3>
<ol>
<li><p><strong>Verify System Stability</strong>:</p>
<ul>
<li><input disabled="" type="checkbox"> Monitor error rate for 30 minutes</li>
<li><input disabled="" type="checkbox"> Verify health checks passing</li>
<li><input disabled="" type="checkbox"> Check database performance</li>
<li><input disabled="" type="checkbox"> Monitor user activity</li>
</ul>
</li>
<li><p><strong>Communication</strong>:</p>
<ul>
<li><input disabled="" type="checkbox"> Update #incidents channel with final status</li>
<li><input disabled="" type="checkbox"> Notify stakeholders of resolution</li>
<li><input disabled="" type="checkbox"> Post user-facing status update (if applicable)</li>
</ul>
</li>
<li><p><strong>Preserve Evidence</strong>:</p>
<ul>
<li><input disabled="" type="checkbox"> Export logs from failed deployment</li>
<li><input disabled="" type="checkbox"> Save Sentry errors and stack traces</li>
<li><input disabled="" type="checkbox"> Screenshot metrics showing issue</li>
<li><input disabled="" type="checkbox"> Export database state (if relevant)</li>
</ul>
</li>
</ol>
<h3>Short-Term Actions (Within 24 Hours)</h3>
<ol>
<li><p><strong>Root Cause Analysis</strong>:</p>
<ul>
<li><input disabled="" type="checkbox"> Identify what went wrong</li>
<li><input disabled="" type="checkbox"> Determine why it wasn&#39;t caught in testing</li>
<li><input disabled="" type="checkbox"> Document findings</li>
</ul>
</li>
<li><p><strong>Create Fix</strong>:</p>
<ul>
<li><input disabled="" type="checkbox"> Create ticket for proper fix</li>
<li><input disabled="" type="checkbox"> Assign owner</li>
<li><input disabled="" type="checkbox"> Add tests to prevent recurrence</li>
</ul>
</li>
<li><p><strong>Post-Mortem</strong>:</p>
<ul>
<li><input disabled="" type="checkbox"> Schedule blameless post-mortem meeting</li>
<li><input disabled="" type="checkbox"> Document timeline of events</li>
<li><input disabled="" type="checkbox"> Identify action items for prevention</li>
</ul>
</li>
</ol>
<h3>Long-Term Actions (Within 1 Week)</h3>
<ol>
<li><p><strong>Improve Testing</strong>:</p>
<ul>
<li><input disabled="" type="checkbox"> Add tests that would have caught the issue</li>
<li><input disabled="" type="checkbox"> Improve E2E test coverage</li>
<li><input disabled="" type="checkbox"> Add integration tests</li>
</ul>
</li>
<li><p><strong>Update Procedures</strong>:</p>
<ul>
<li><input disabled="" type="checkbox"> Update deployment checklist</li>
<li><input disabled="" type="checkbox"> Improve pre-deployment testing</li>
<li><input disabled="" type="checkbox"> Update rollback procedures (if needed)</li>
</ul>
</li>
<li><p><strong>Implement Fix</strong>:</p>
<ul>
<li><input disabled="" type="checkbox"> Deploy proper fix with comprehensive testing</li>
<li><input disabled="" type="checkbox"> Verify fix resolves root cause</li>
<li><input disabled="" type="checkbox"> Monitor for recurrence</li>
</ul>
</li>
</ol>
<hr>
<h2>Testing Rollback Procedures</h2>
<p><strong>Test rollback procedures quarterly to ensure readiness</strong></p>
<h3>Rollback Drill Procedure</h3>
<ol>
<li><p><strong>Schedule Drill</strong>:</p>
<ul>
<li>Choose low-traffic time (e.g., Tuesday 2 PM)</li>
<li>Notify team of drill</li>
<li>Use staging/preview environment</li>
</ul>
</li>
<li><p><strong>Execute Simulated Rollback</strong>:</p>
<pre><code class="language-bash"># 1. Deploy to preview
vercel deploy --preview

# 2. Simulate issue detection

# 3. Execute rollback procedure
vercel promote [previous-deployment]

# 4. Verify rollback successful

# 5. Time the process
</code></pre>
</li>
<li><p><strong>Review and Improve</strong>:</p>
<ul>
<li>Document time taken</li>
<li>Identify friction points</li>
<li>Update procedures</li>
<li>Train team members</li>
</ul>
</li>
</ol>
<h3>Checklist for Rollback Drills</h3>
<ul>
<li><input disabled="" type="checkbox"> All team members know how to access Vercel dashboard</li>
<li><input disabled="" type="checkbox"> All team members can identify last known good deployment</li>
<li><input disabled="" type="checkbox"> Rollback can be executed in &lt; 5 minutes</li>
<li><input disabled="" type="checkbox"> Team knows database rollback risks</li>
<li><input disabled="" type="checkbox"> Communication channels tested</li>
<li><input disabled="" type="checkbox"> Monitoring dashboards accessible</li>
</ul>
<hr>
<h2>Rollback Decision Matrix</h2>
<table>
<thead>
<tr>
<th>Issue Type</th>
<th>Impact</th>
<th>Response Time</th>
<th>Action</th>
</tr>
</thead>
<tbody><tr>
<td>Security breach</td>
<td>Critical</td>
<td>Immediate</td>
<td>Rollback + incident response</td>
</tr>
<tr>
<td>Data loss/corruption</td>
<td>Critical</td>
<td>Immediate</td>
<td>Rollback + restore backup</td>
</tr>
<tr>
<td>Complete outage</td>
<td>Critical</td>
<td>&lt; 5 min</td>
<td>Rollback</td>
</tr>
<tr>
<td>Error rate &gt; 5%</td>
<td>High</td>
<td>&lt; 15 min</td>
<td>Rollback (if no quick fix)</td>
</tr>
<tr>
<td>Error rate 1-5%</td>
<td>Medium</td>
<td>&lt; 30 min</td>
<td>Investigate, then rollback or hotfix</td>
</tr>
<tr>
<td>Performance degradation</td>
<td>Medium</td>
<td>&lt; 30 min</td>
<td>Investigate, then decide</td>
</tr>
<tr>
<td>Minor bug</td>
<td>Low</td>
<td>N/A</td>
<td>Create fix, deploy normally</td>
</tr>
</tbody></table>
<hr>
<h2>Emergency Contacts</h2>
<p><strong>Rollback Authority</strong> (can approve rollback):</p>
<ol>
<li>On-call engineer (any severity)</li>
<li>Tech lead (CRITICAL/HIGH)</li>
<li>Engineering manager (CRITICAL)</li>
</ol>
<p><strong>Required Notification</strong>:</p>
<ul>
<li>Slack: #incidents channel</li>
<li>On-call: Primary and secondary</li>
<li>Management: For CRITICAL issues</li>
</ul>
<p><strong>External Support</strong>:</p>
<ul>
<li><strong>Vercel</strong>: <a href="mailto:support@vercel.com">support@vercel.com</a> (for deployment issues)</li>
<li><strong>Neon</strong>: <a href="mailto:support@neon.tech">support@neon.tech</a> (for database issues)</li>
<li><strong>Sentry</strong>: <a href="mailto:support@sentry.io">support@sentry.io</a> (for monitoring issues)</li>
</ul>
<hr>
<h2>Appendix: Rollback Commands Reference</h2>
<pre><code class="language-bash"># Vercel - List deployments
vercel list --scope [your-org]

# Vercel - Promote specific deployment
vercel promote [deployment-url]

# Git - Revert commit
git revert [commit-sha]

# Git - Revert multiple commits
git revert [sha1] [sha2] [sha3]

# Database - Check migration status
npm run db:migrate:status

# Database - Rollback one migration
npm run db:migrate:rollback

# Database - Backup
pg_dump $DATABASE_URL &gt; backup.sql

# Health check
curl https://[domain]/health

# Metrics check
curl -H &quot;Authorization: Bearer $TOKEN&quot; https://[domain]/metrics
</code></pre>
<hr>
<p><strong>Document Version</strong>: 1.0
<strong>Last Review</strong>: 2025-11-08
<strong>Next Review</strong>: After first rollback or quarterly
<strong>Last Drill</strong>: [Schedule first drill]</p>

      </article>
      <footer class="content-footer">
        <p>
          <strong>Care Commons</strong> - Shared care software, community owned<br>
          Brought to you by <a href="https://neighborhoodlab.org" target="_blank">Neighborhood Lab</a>
        </p>
      </footer>
    </main>
  </div>
</body>
</html>